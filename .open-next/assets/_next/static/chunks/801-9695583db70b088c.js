"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[801],{801:function(e,t,a){a.d(t,{Z:function(){return I}});var r=a(7437),n=a(7648),s=a(9376),l=a(3448),i=a(4362),o=a(4938),c=a(3247),d=a(8736),u=a(2369),x=a(5466),h=a(5005),m=a(5805),f=a(1671),p=a(44),b=a(4948),g=a(7692);function v(){let e=(0,s.usePathname)(),{user:t,logout:a}=(0,i.a)();console.log("Sidebar user role:",null==t?void 0:t.role);let v=(()=>{if(!t)return[];switch(t.role){case"student":return[{icon:o.Z,label:"ホーム",href:"/"},{icon:c.Z,label:"求人検索",href:"/student/jobs"},{icon:d.Z,label:"応募履歴",href:"/student/applications"},{icon:u.Z,label:"プロフィール",href:"/student/profile"}];case"company":return[{icon:x.Z,label:"ダッシュボード",href:"/company/dashboard"},{icon:h.Z,label:"自社求人管理",href:"/company/jobs"},{icon:m.Z,label:"応募者管理",href:"/company/applicants"},{icon:u.Z,label:"企業情報",href:"/company/profile"}];case"admin":return[{icon:x.Z,label:"ダッシュボード",href:"/admin/dashboard"},{icon:f.Z,label:"求人承認",href:"/admin/jobs"},{icon:d.Z,label:"応募管理",href:"/admin/applications"},{icon:m.Z,label:"ユーザー管理",href:"/admin/users"},{icon:p.Z,label:"企業管理",href:"/admin/companies"},{icon:b.Z,label:"インターン実施状況",href:"/admin/matches"}];default:return[{icon:o.Z,label:"ホーム",href:"/"}]}})();return(0,r.jsxs)("aside",{className:"fixed left-4 top-4 z-40 h-[calc(100vh-2rem)] w-18 glass rounded-2xl border-r-0 flex flex-col items-center py-6 transition-all duration-300",children:[(0,r.jsx)("div",{className:"mb-8 p-2 rounded-xl bg-[#161B33]/10",children:(0,r.jsx)("div",{className:"w-8 h-8 rounded-full bg-[#161B33]"})}),(0,r.jsx)("nav",{className:"flex-1 flex flex-col gap-4 w-full px-2",children:v.map(t=>{let a=e===t.href||e.startsWith(t.href+"/");return(0,r.jsxs)(n.default,{href:t.href,className:(0,l.cn)("relative group flex items-center justify-center w-12 h-12 rounded-xl transition-all duration-200",a?"bg-[#161B33] text-white shadow-md shadow-[#161B33]/20":"text-gray-500 hover:bg-[#161B33]/10 hover:text-[#161B33]"),children:[(0,r.jsx)(t.icon,{size:22,strokeWidth:a?2.5:2}),(0,r.jsx)("span",{className:"absolute left-14 px-2 py-1 bg-[#1E3A5F] text-white text-xs rounded opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all whitespace-nowrap z-50",children:t.label})]},t.href)})}),(0,r.jsx)("button",{onClick:a,className:"mt-auto p-3 text-gray-500 hover:text-[#F56565] hover:bg-[#F56565]/10 rounded-xl transition-all",children:(0,r.jsx)(g.Z,{size:22})})]})}var y=a(1437),j=a(4766),w=a(401),N=a(2265),k=a(9795),Z=a(9073);function A(){let{user:e}=(0,i.a)(),{notifications:t,unreadCount:a}=(0,y.z)(null==e?void 0:e.id,null==e?void 0:e.role),[n,l]=(0,N.useState)(!1),o=(0,s.useRouter)(),c=(0,N.useRef)(null);(0,N.useEffect)(()=>{function e(e){c.current&&!c.current.contains(e.target)&&l(!1)}return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[c]);let d=async e=>{e.read||await y.B.markAsRead(e.id),l(!1),e.link&&o.push(e.link)},u=async()=>{e&&await y.B.markAllAsRead(e.id)};return e?(0,r.jsxs)("div",{className:"relative",ref:c,children:[(0,r.jsxs)("button",{className:"relative p-2 text-gray-500 hover:text-gray-700 transition-colors",onClick:()=>l(!n),children:[(0,r.jsx)(j.Z,{size:24}),a>0&&(0,r.jsx)("span",{className:"absolute top-0 right-0 inline-flex items-center justify-center px-1.5 py-0.5 text-xs font-bold leading-none text-red-100 bg-red-600 rounded-full transform translate-x-1/4 -translate-y-1/4",children:a>9?"9+":a})]}),n&&(0,r.jsxs)("div",{className:"absolute right-0 mt-2 w-80 bg-white rounded-lg shadow-xl border border-gray-100 z-50 overflow-hidden",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center px-4 py-2 border-b bg-gray-50",children:[(0,r.jsx)("h3",{className:"text-sm font-bold text-gray-700",children:"通知"}),a>0&&(0,r.jsxs)("button",{onClick:u,className:"text-xs text-blue-600 hover:text-blue-800 flex items-center gap-1",children:[(0,r.jsx)(w.Z,{size:12}),"すべて既読にする"]})]}),(0,r.jsx)("div",{className:"max-h-96 overflow-y-auto",children:0===t.length?(0,r.jsx)("div",{className:"p-8 text-center text-gray-400 text-sm",children:"通知はありません"}):(0,r.jsx)("ul",{className:"divide-y divide-gray-100",children:t.map(e=>(0,r.jsx)("li",{className:"p-3 hover:bg-gray-50 cursor-pointer transition-colors ".concat(e.read?"":"bg-blue-50/50"),onClick:()=>d(e),children:(0,r.jsxs)("div",{className:"flex gap-3",children:[(0,r.jsx)("div",{className:"mt-1",children:e.read?(0,r.jsx)("div",{className:"w-2 h-2 bg-gray-300 rounded-full"}):(0,r.jsx)("div",{className:"w-2 h-2 bg-blue-500 rounded-full"})}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-800 mb-1",children:e.title}),(0,r.jsx)("p",{className:"text-xs text-gray-500 line-clamp-2 mb-1",children:e.message}),(0,r.jsx)("p",{className:"text-[10px] text-gray-400",children:e.createdAt?(0,k.Q)(e.createdAt.toDate(),{addSuffix:!0,locale:Z.ja}):"-"})]})]})},e.id))})}),(0,r.jsx)("div",{className:"p-2 border-t bg-gray-50 text-center",children:(0,r.jsx)("button",{onClick:()=>o.push("/settings/notifications"),className:"text-xs text-gray-500 hover:text-gray-700",children:"通知設定"})})]})]}):null}function B(){let{user:e}=(0,i.a)();return(0,r.jsxs)("header",{className:"sticky top-0 z-30 w-full h-16 px-6 flex items-center justify-between glass border-b-0 rounded-2xl mx-auto max-w-[98%] mt-2",children:[(0,r.jsx)("div",{className:"flex items-center gap-4 flex-1",children:(0,r.jsxs)("div",{className:"relative w-64 md:w-96 hidden md:block",children:[(0,r.jsx)(c.Z,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 h-4 w-4"}),(0,r.jsx)("input",{type:"text",placeholder:"検索...",className:"w-full h-10 pl-10 pr-4 rounded-full bg-white/50 border-none focus:ring-2 focus:ring-[#161B33]/20 text-sm shadow-sm backdrop-blur-sm transition-all"})]})}),(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsx)(A,{}),(0,r.jsxs)(n.default,{href:(null==e?void 0:e.role)==="student"?"/student/profile":(null==e?void 0:e.role)==="company"?"/company/profile":"/",className:"flex items-center gap-3 pl-4 border-l border-gray-200 hover:opacity-80 transition-opacity",children:[(0,r.jsxs)("div",{className:"text-right hidden sm:block",children:[(0,r.jsx)("p",{className:"text-sm font-medium text-[#161B33]",children:(null==e?void 0:e.name)||"ゲスト"}),(0,r.jsx)("p",{className:"text-xs text-gray-500",children:(null==e?void 0:e.role)==="student"?"学生アカウント":(null==e?void 0:e.role)==="company"?"企業アカウント":(null==e?void 0:e.role)==="admin"?"管理者":"ゲスト"})]}),(0,r.jsx)("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-[#161B33] to-[#2D5A8E] shadow-md border-2 border-white cursor-pointer"})]})]})]})}function I(e){let{children:t}=e;return(0,r.jsxs)("div",{className:"min-h-screen text-[#161B33] font-sans",children:[(0,r.jsx)(v,{}),(0,r.jsxs)("div",{className:"pl-24 flex flex-col min-h-screen transition-all duration-300",children:[(0,r.jsx)(B,{}),(0,r.jsx)("main",{className:"flex-1 p-6 md:p-8 overflow-x-hidden",children:(0,r.jsx)("div",{className:"max-w-7xl mx-auto space-y-8 animate-in fade-in slide-in-from-bottom-4 duration-500",children:t})})]})]})}},4362:function(e,t,a){a.d(t,{AuthProvider:function(){return d},a:function(){return u}});var r=a(7437),n=a(2265),s=a(1466),l=a(6943),i=a(6410),o=a(9376);let c=(0,n.createContext)({user:null,firebaseUser:null,loading:!0,emailVerified:!1,logout:async()=>{},refreshUser:async()=>{}});function d(e){let{children:t}=e,[a,d]=(0,n.useState)(null),[u,x]=(0,n.useState)(null),[h,m]=(0,n.useState)(!0),[f,p]=(0,n.useState)(!1),b=(0,o.useRouter)(),g=async e=>{try{let t=await (0,l.getDoc)((0,l.doc)(i.db,"users",e.uid));t.exists()?d({id:t.id,...t.data()}):d(null)}catch(e){console.error("Error fetching user data:",e),d(null)}};(0,n.useEffect)(()=>{let e=(0,s.Aj)(i.I,async e=>{x(e),e?(p(e.emailVerified),await g(e)):(d(null),p(!1)),m(!1)});return()=>e()},[]);let v=async()=>{await (0,s.w7)(i.I),d(null),x(null),p(!1),b.push("/login")},y=async()=>{let e=i.I.currentUser;e&&(await e.reload(),p(e.emailVerified),await g(e))};return(0,r.jsx)(c.Provider,{value:{user:a,firebaseUser:u,loading:h,emailVerified:f,logout:v,refreshUser:y},children:t})}let u=()=>(0,n.useContext)(c)},6410:function(e,t,a){a.d(t,{I:function(){return i},V:function(){return c},db:function(){return o}});var r=a(738),n=a(1466),s=a(6943);let l=0===(0,r.C6)().length?(0,r.ZF)({apiKey:"AIzaSyDL2GylAt2YVRSstEpp4hucbcqw7RuVk4o",authDomain:"internship-matching-app.firebaseapp.com",projectId:"internship-matching-app",messagingSenderId:"299078518812",appId:"1:299078518812:web:03ad34bb4323c497a677d9"}):(0,r.C6)()[0],i=(0,n.v0)(l),o=(0,s.ad)(l),c=new n.hJ},3448:function(e,t,a){a.d(t,{cn:function(){return s}});var r=a(1994),n=a(3335);function s(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,n.m6)((0,r.W)(t))}},1437:function(e,t,a){a.d(t,{B:function(){return i},z:function(){return o}});var r=a(6410),n=a(6943),s=a(2265);class l{async markAsRead(e){let t=(0,n.doc)(r.db,"notifications",e);await (0,n.r7)(t,{read:!0,updatedAt:(0,n.Bt)()})}async markAllAsRead(e){let t=(0,n.IO)((0,n.hJ)(r.db,"notifications"),(0,n.ar)("userId","==",e),(0,n.ar)("read","==",!1)),a=await (0,n.PL)(t);if(a.empty)return;let s=(0,n.qs)(r.db);a.docs.forEach(e=>{s.update(e.ref,{read:!0,updatedAt:(0,n.Bt)()})}),await s.commit()}async createNotification(e,t,a,s,l){try{await (0,n.ET)((0,n.hJ)(r.db,"notifications"),{userId:e,title:t,message:a,type:s,link:l,read:!1,createdAt:(0,n.Bt)()})}catch(e){console.error("Error creating notification:",e)}}}let i=new l;function o(e,t){let[a,l]=(0,s.useState)([]),[i,o]=(0,s.useState)(0),[c,d]=(0,s.useState)(!0);return(0,s.useEffect)(()=>{let a;if(!e){l([]),o(0),d(!1);return}a="admin"===t?(0,n.IO)((0,n.hJ)(r.db,"notifications"),(0,n.ar)("userId","in",[e,"admin"]),(0,n.Xo)("createdAt","desc"),(0,n.b9)(20)):(0,n.IO)((0,n.hJ)(r.db,"notifications"),(0,n.ar)("userId","==",e),(0,n.Xo)("createdAt","desc"),(0,n.b9)(20));let s=(0,n.cf)(a,e=>{let t=e.docs.map(e=>({id:e.id,...e.data()}));l(t),o(t.filter(e=>!e.read).length),d(!1)},e=>{console.error("Notification listener error:",e),d(!1)});return()=>s()},[e,t]),{notifications:a,unreadCount:i,loading:c}}}}]);