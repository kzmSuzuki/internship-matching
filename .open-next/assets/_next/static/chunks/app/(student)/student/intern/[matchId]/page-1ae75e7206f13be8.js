(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1354],{6559:function(e,t,s){Promise.resolve().then(s.bind(s,2551))},9397:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(8755).Z)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},2551:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return v}});var a=s(7437),l=s(2265),i=s(4362),n=s(4279),r=s(6943),c=s(6410),d=s(757),o=s(6334),m=s(2827),u=s(8711),x=s(3008),h=s(1817),f=s(9397),p=s(1047),b=s(3417),j=s(6424),y=s(6256);function v(e){let{params:t}=e,{matchId:s}=t,{user:v}=(0,i.a)(),[g,N]=(0,l.useState)(null),[w,k]=(0,l.useState)(null),[S,C]=(0,l.useState)([]),[E,D]=(0,l.useState)(!0),[M,z]=(0,l.useState)(null),[I,Z]=(0,l.useState)(0),[F,_]=(0,l.useState)(""),[A,R]=(0,l.useState)(!1),[q,B]=(0,l.useState)(!1),[O,P]=(0,l.useState)(new Date().toISOString().split("T")[0]),[U,W]=(0,l.useState)(""),[G,L]=(0,l.useState)(""),[T,H]=(0,l.useState)(""),[J,K]=(0,l.useState)(!1);(0,l.useEffect)(()=>{!async function(){if(v)try{let e=await n.i.getMatch(s);if(!e||e.studentId!==v.id)throw Error("Match not found or unauthorized");N(e);let t=await (0,r.getDoc)((0,r.doc)(c.db,"companies",e.companyId));t.exists()&&k(t.data());let a=await n.i.getReports(s);if(C(a),"completed"===e.status){let e=await n.i.getEvaluation(s,v.id);z(e)}}catch(e){console.error("Error fetching data:",e)}finally{D(!1)}}()},[s,v]);let Q=async e=>{if(e.preventDefault(),v&&g){K(!0);try{await n.i.createReport(v.id,g.id,U,G,T,new Date(O)),B(!1);let e=await n.i.getReports(g.id);C(e),W(""),L(""),H("")}catch(t){console.error("Failed to create report:",t);let e="日報の作成に失敗しました";"permission-denied"===t.code?(e="権限がありません。管理者にお問い合わせください。",console.error("Permission context:",{uid:v.id,role:v.role,matchStudentId:g.studentId,reportDate:O})):t.message&&(e+=": ".concat(t.message)),alert(e)}finally{K(!1)}}};return E?(0,a.jsx)("div",{className:"flex justify-center p-12",children:(0,a.jsx)(h.Z,{className:"animate-spin"})}):g?(0,a.jsxs)("div",{className:"max-w-4xl mx-auto space-y-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center bg-[#1E3A5F] text-white p-6 rounded-xl shadow-lg",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("h1",{className:"text-xl font-bold mb-1",children:[null==w?void 0:w.name," インターンシップ"]}),(0,a.jsxs)("p",{className:"text-sm opacity-90",children:["期間: ",g.startDate?(0,j.WU)(g.startDate.toDate(),"yyyy/MM/dd"):"-",g.endDate?" ~ ".concat((0,j.WU)(g.endDate.toDate(),"yyyy/MM/dd")):" ~ 進行中"]})]}),"active"===g.status?(0,a.jsx)(u.C,{variant:"success",className:"bg-[#48BB78] text-white border-none",children:"進行中"}):(0,a.jsx)(u.C,{variant:"outline",className:"text-white border-white",children:"完了"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,a.jsxs)("div",{className:"md:col-span-2 space-y-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("h2",{className:"text-lg font-bold text-[#1E3A5F]",children:"日報一覧"}),"active"===g.status&&(0,a.jsxs)(o.z,{size:"sm",onClick:()=>B(!0),children:[(0,a.jsx)(f.Z,{size:16,className:"mr-1"}),"日報を書く"]})]}),0===S.length?(0,a.jsx)(d.Z,{className:"p-8 text-center text-gray-500",children:"まだ日報がありません。"}):(0,a.jsx)("div",{className:"space-y-4",children:S.map(e=>(0,a.jsxs)(d.Z,{className:"p-5",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-3 border-b pb-2",children:[(0,a.jsx)(p.Z,{size:16,className:"text-gray-400"}),(0,a.jsx)("span",{className:"font-bold text-[#1E3A5F]",children:(0,j.WU)(e.date.toDate(),"yyyy/MM/dd")})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-xs text-gray-400 block",children:"業務内容"}),(0,a.jsx)("p",{className:"text-sm text-gray-800 whitespace-pre-wrap",children:e.content})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-xs text-gray-400 block",children:"学んだこと"}),(0,a.jsx)("p",{className:"text-sm text-gray-800 whitespace-pre-wrap",children:e.learning})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-xs text-gray-400 block",children:"明日の目標"}),(0,a.jsx)("p",{className:"text-sm text-gray-800 whitespace-pre-wrap",children:e.nextGoals})]}),e.companyComment&&(0,a.jsxs)("div",{className:"bg-blue-50 p-3 rounded-lg mt-2 text-sm",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1 text-blue-800 font-bold mb-1",children:[(0,a.jsx)(b.Z,{size:14}),"企業からのコメント"]}),(0,a.jsx)("p",{className:"text-blue-900",children:e.companyComment})]})]})]},e.id))})]}),(0,a.jsx)("div",{className:"space-y-6",children:"completed"===g.status&&(0,a.jsx)(y.B,{evaluation:M,onSubmit:async(e,t)=>{if(v&&g&&w&&confirm("評価を送信しますか？送信後は変更できません。")){R(!0);try{await n.i.submitEvaluation(g.id,v.id,w.userId,e,t);let s=await n.i.getEvaluation(g.id,v.id);z(s)}catch(e){console.error(e),alert("評価の送信に失敗しました")}finally{R(!1)}}},isSubmitting:A,userRole:"student",targetName:(null==w?void 0:w.name)||"企業"})})]}),(0,a.jsx)(x.u,{isOpen:q,onClose:()=>B(!1),title:"日報の作成",children:(0,a.jsxs)("form",{onSubmit:Q,className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",children:"日付"}),(0,a.jsx)(m.I,{type:"date",value:O,onChange:e=>P(e.target.value),required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",children:"業務内容"}),(0,a.jsx)("textarea",{className:"w-full border rounded p-2 min-h-[80px]",value:U,onChange:e=>W(e.target.value),required:!0,placeholder:"今日行ったタスク..."})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",children:"学んだこと"}),(0,a.jsx)("textarea",{className:"w-full border rounded p-2 min-h-[80px]",value:G,onChange:e=>L(e.target.value),required:!0,placeholder:"気づきや学び..."})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",children:"明日の目標"}),(0,a.jsx)("textarea",{className:"w-full border rounded p-2 min-h-[60px]",value:T,onChange:e=>H(e.target.value),required:!0,placeholder:"次にやること..."})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-2 pt-2",children:[(0,a.jsx)(o.z,{type:"button",variant:"secondary",onClick:()=>B(!1),children:"キャンセル"}),(0,a.jsx)(o.z,{type:"submit",isLoading:J,children:"保存する"})]})]})})]}):(0,a.jsx)("div",{className:"p-12 text-center",children:"データが見つかりません"})}},2827:function(e,t,s){"use strict";s.d(t,{I:function(){return n}});var a=s(7437),l=s(2265),i=s(3448);let n=(0,l.forwardRef)((e,t)=>{let{className:s,error:l,label:n,...r}=e;return(0,a.jsxs)("div",{className:"w-full",children:[n&&(0,a.jsx)("label",{className:"block text-sm font-medium text-[#1A202C] mb-1.5",children:n}),(0,a.jsx)("input",{ref:t,className:(0,i.cn)("flex h-10 w-full rounded-lg border border-gray-200 bg-white/50 px-3 py-2 text-sm ring-offset-white file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-gray-400 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[#1E3A5F] disabled:cursor-not-allowed disabled:opacity-50 transition-all backdrop-blur-sm",l&&"border-[#F56565] focus-visible:ring-[#F56565]",s),...r}),l&&(0,a.jsx)("p",{className:"mt-1 text-sm text-[#F56565]",children:l})]})});n.displayName="Input"},3008:function(e,t,s){"use strict";s.d(t,{u:function(){return c}});var a=s(7437),l=s(2265),i=s(4887);let n=(0,s(8755).Z)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);var r=s(3448);function c(e){let{isOpen:t,onClose:s,title:c,children:d,className:o}=e;return((0,l.useEffect)(()=>(t?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[t]),t)?(0,i.createPortal)((0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 sm:p-6 bg-black/40 backdrop-blur-sm animate-in fade-in duration-200",children:(0,a.jsxs)("div",{className:(0,r.cn)("relative w-full max-w-lg transform rounded-2xl bg-white/80 backdrop-blur-2xl p-6 text-left align-middle shadow-2xl transition-all animate-in zoom-in-95 duration-200 border border-white/40",o),children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[c&&(0,a.jsx)("h3",{className:"text-lg font-medium leading-6 text-[#161B33]",children:c}),(0,a.jsx)("button",{onClick:s,className:"rounded-full p-1 hover:bg-gray-100 transition-colors",children:(0,a.jsx)(n,{className:"h-5 w-5 text-gray-500"})})]}),(0,a.jsx)("div",{children:d})]})}),document.body):null}}},function(e){e.O(0,[287,8483,1442,8697,6165,1208,2971,2117,1744],function(){return e(e.s=6559)}),_N_E=e.O()}]);