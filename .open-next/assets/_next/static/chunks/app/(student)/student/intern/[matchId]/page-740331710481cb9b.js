(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1354],{6559:function(e,t,a){Promise.resolve().then(a.bind(a,2551))},1047:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});let s=(0,a(8755).Z)("calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]])},3417:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});let s=(0,a(8755).Z)("message-square",[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]])},9397:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});let s=(0,a(8755).Z)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},9376:function(e,t,a){"use strict";var s=a(5475);a.o(s,"useParams")&&a.d(t,{useParams:function(){return s.useParams}}),a.o(s,"usePathname")&&a.d(t,{usePathname:function(){return s.usePathname}}),a.o(s,"useRouter")&&a.d(t,{useRouter:function(){return s.useRouter}})},2551:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return g}});var s=a(7437),r=a(2265),n=a(4362),l=a(4279),i=a(6943),d=a(6410),c=a(757),o=a(6334),u=a(2827),m=a(8711),x=a(3008),h=a(1817),p=a(9397),f=a(1047),b=a(3417),y=a(7735);function g(e){let{params:t}=e,{matchId:a}=t,{user:g}=(0,n.a)(),[v,j]=(0,r.useState)(null),[w,N]=(0,r.useState)(null),[E,k]=(0,r.useState)([]),[C,I]=(0,r.useState)(!0),[S,A]=(0,r.useState)(null),[D,F]=(0,r.useState)(0),[R,M]=(0,r.useState)(""),[B,Z]=(0,r.useState)(!1),[z,P]=(0,r.useState)(!1),[q,O]=(0,r.useState)(new Date().toISOString().split("T")[0]),[V,J]=(0,r.useState)(""),[L,U]=(0,r.useState)(""),[_,T]=(0,r.useState)(""),[W,G]=(0,r.useState)(!1);(0,r.useEffect)(()=>{!async function(){if(g)try{let e=await l.i.getMatch(a);if(!e||e.studentId!==g.id)throw Error("Match not found or unauthorized");j(e);let t=await (0,i.getDoc)((0,i.doc)(d.db,"companies",e.companyId));t.exists()&&N(t.data());let s=await l.i.getReports(a);if(k(s),"completed"===e.status){let e=await l.i.getEvaluation(a,g.id);A(e)}}catch(e){console.error("Error fetching data:",e)}finally{I(!1)}}()},[a,g]);let K=async e=>{if(e.preventDefault(),g&&v){G(!0);try{await l.i.createReport(g.id,v.id,V,L,_,new Date(q)),P(!1);let e=await l.i.getReports(v.id);k(e),J(""),U(""),T("")}catch(t){console.error("Failed to create report:",t);let e="日報の作成に失敗しました";"permission-denied"===t.code?(e="権限がありません。管理者にお問い合わせください。",console.error("Permission context:",{uid:g.id,role:g.role,matchStudentId:v.studentId,reportDate:q})):t.message&&(e+=": ".concat(t.message)),alert(e)}finally{G(!1)}}},H=async e=>{if(e.preventDefault(),g&&v&&w&&confirm("評価を送信しますか？送信後は変更できません。")){Z(!0);try{await l.i.submitEvaluation(v.id,g.id,w.userId,D,R);let e=await l.i.getEvaluation(v.id,g.id);A(e)}catch(e){console.error(e),alert("評価の送信に失敗しました")}finally{Z(!1)}}};return C?(0,s.jsx)("div",{className:"flex justify-center p-12",children:(0,s.jsx)(h.Z,{className:"animate-spin"})}):v?(0,s.jsxs)("div",{className:"max-w-4xl mx-auto space-y-6",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center bg-[#1E3A5F] text-white p-6 rounded-xl shadow-lg",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("h1",{className:"text-xl font-bold mb-1",children:[null==w?void 0:w.name," インターンシップ"]}),(0,s.jsxs)("p",{className:"text-sm opacity-90",children:["期間: ",v.startDate?(0,y.WU)(v.startDate.toDate(),"yyyy/MM/dd"):"-",v.endDate?" ~ ".concat((0,y.WU)(v.endDate.toDate(),"yyyy/MM/dd")):" ~ 進行中"]})]}),"active"===v.status?(0,s.jsx)(m.C,{variant:"success",className:"bg-[#48BB78] text-white border-none",children:"進行中"}):(0,s.jsx)(m.C,{variant:"outline",className:"text-white border-white",children:"完了"})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,s.jsxs)("div",{className:"md:col-span-2 space-y-6",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("h2",{className:"text-lg font-bold text-[#1E3A5F]",children:"日報一覧"}),"active"===v.status&&(0,s.jsxs)(o.z,{size:"sm",onClick:()=>P(!0),children:[(0,s.jsx)(p.Z,{size:16,className:"mr-1"}),"日報を書く"]})]}),0===E.length?(0,s.jsx)(c.Z,{className:"p-8 text-center text-gray-500",children:"まだ日報がありません。"}):(0,s.jsx)("div",{className:"space-y-4",children:E.map(e=>(0,s.jsxs)(c.Z,{className:"p-5",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-3 border-b pb-2",children:[(0,s.jsx)(f.Z,{size:16,className:"text-gray-400"}),(0,s.jsx)("span",{className:"font-bold text-[#1E3A5F]",children:(0,y.WU)(e.date.toDate(),"yyyy/MM/dd")})]}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-xs text-gray-400 block",children:"業務内容"}),(0,s.jsx)("p",{className:"text-sm text-gray-800 whitespace-pre-wrap",children:e.content})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-xs text-gray-400 block",children:"学んだこと"}),(0,s.jsx)("p",{className:"text-sm text-gray-800 whitespace-pre-wrap",children:e.learning})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-xs text-gray-400 block",children:"明日の目標"}),(0,s.jsx)("p",{className:"text-sm text-gray-800 whitespace-pre-wrap",children:e.nextGoals})]}),e.companyComment&&(0,s.jsxs)("div",{className:"bg-blue-50 p-3 rounded-lg mt-2 text-sm",children:[(0,s.jsxs)("div",{className:"flex items-center gap-1 text-blue-800 font-bold mb-1",children:[(0,s.jsx)(b.Z,{size:14}),"企業からのコメント"]}),(0,s.jsx)("p",{className:"text-blue-900",children:e.companyComment})]})]})]},e.id))})]}),(0,s.jsx)("div",{className:"space-y-6",children:"completed"===v.status&&(0,s.jsxs)(c.Z,{className:"p-6",children:[(0,s.jsx)("h2",{className:"text-lg font-bold mb-4 text-[#1E3A5F]",children:"インターン評価"}),S?(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"bg-[#48BB78]/10 text-center py-4 rounded-lg",children:[(0,s.jsx)("span",{className:"block text-xs text-gray-500",children:"評価完了"}),(0,s.jsx)("span",{className:"text-2xl font-bold text-[#2F855A]",children:"送信済み"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-xs text-gray-400",children:"スコア"}),(0,s.jsx)("div",{className:"flex text-yellow-500",children:[void 0,void 0,void 0,void 0,void 0].map((e,t)=>(0,s.jsx)("span",{className:t<S.score?"text-yellow-500":"text-gray-300",children:"★"},t))})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-xs text-gray-400",children:"コメント"}),(0,s.jsx)("p",{className:"text-sm",children:S.comment})]})]}):(0,s.jsxs)("form",{onSubmit:H,className:"space-y-4",children:[(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"インターンシップが終了しました。 体験を通じた企業の評価を入力してください。"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-1",children:"評価スコア (1-5)"}),(0,s.jsxs)("select",{className:"w-full border rounded p-2",value:D,onChange:e=>F(Number(e.target.value)),required:!0,children:[(0,s.jsx)("option",{value:"0",children:"選択してください"}),(0,s.jsx)("option",{value:"5",children:"5 - とても良かった"}),(0,s.jsx)("option",{value:"4",children:"4 - 良かった"}),(0,s.jsx)("option",{value:"3",children:"3 - 普通"}),(0,s.jsx)("option",{value:"2",children:"2 - あまり良くなかった"}),(0,s.jsx)("option",{value:"1",children:"1 - 良くなかった"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-1",children:"コメント"}),(0,s.jsx)("textarea",{className:"w-full border rounded p-2 min-h-[100px]",value:R,onChange:e=>M(e.target.value),required:!0,placeholder:"フィードバックや感想を入力..."})]}),(0,s.jsx)(o.z,{type:"submit",className:"w-full",isLoading:B,disabled:0===D,children:"評価を送信する"})]})]})})]}),(0,s.jsx)(x.u,{isOpen:z,onClose:()=>P(!1),title:"日報の作成",children:(0,s.jsxs)("form",{onSubmit:K,className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-1",children:"日付"}),(0,s.jsx)(u.I,{type:"date",value:q,onChange:e=>O(e.target.value),required:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-1",children:"業務内容"}),(0,s.jsx)("textarea",{className:"w-full border rounded p-2 min-h-[80px]",value:V,onChange:e=>J(e.target.value),required:!0,placeholder:"今日行ったタスク..."})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-1",children:"学んだこと"}),(0,s.jsx)("textarea",{className:"w-full border rounded p-2 min-h-[80px]",value:L,onChange:e=>U(e.target.value),required:!0,placeholder:"気づきや学び..."})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-1",children:"明日の目標"}),(0,s.jsx)("textarea",{className:"w-full border rounded p-2 min-h-[60px]",value:_,onChange:e=>T(e.target.value),required:!0,placeholder:"次にやること..."})]}),(0,s.jsxs)("div",{className:"flex justify-end gap-2 pt-2",children:[(0,s.jsx)(o.z,{type:"button",variant:"secondary",onClick:()=>P(!1),children:"キャンセル"}),(0,s.jsx)(o.z,{type:"submit",isLoading:W,children:"保存する"})]})]})})]}):(0,s.jsx)("div",{className:"p-12 text-center",children:"データが見つかりません"})}},8711:function(e,t,a){"use strict";a.d(t,{C:function(){return l}});var s=a(7437),r=a(2265),n=a(3448);let l=(0,r.forwardRef)((e,t)=>{let{className:a,variant:r="default",...l}=e;return(0,s.jsx)("span",{ref:t,className:(0,n.cn)("inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium transition-colors",{default:"bg-[#1E3A5F]/10 text-[#161B33]",success:"bg-[#48BB78]/10 text-[#48BB78]",warning:"bg-[#ED8936]/10 text-[#ED8936]",error:"bg-[#F56565]/10 text-[#F56565]",outline:"border border-gray-200 text-gray-500"}[r],a),...l})});l.displayName="Badge"},6334:function(e,t,a){"use strict";a.d(t,{z:function(){return i}});var s=a(7437),r=a(2265),n=a(3448),l=a(1817);let i=(0,r.forwardRef)((e,t)=>{let{className:a,variant:r="primary",size:i="md",isLoading:d,children:c,disabled:o,...u}=e;return(0,s.jsxs)("button",{ref:t,className:(0,n.cn)("inline-flex items-center justify-center rounded-lg font-medium transition-all focus:outline-none focus:ring-2 focus:ring-[#1E3A5F]/50 disabled:opacity-50 disabled:cursor-not-allowed",{primary:"bg-gradient-to-r from-[#161B33] to-[#142841] text-white shadow-lg hover:shadow-xl hover:-translate-y-0.5 transition-all duration-300 border border-white/10",secondary:"glass-button text-[#1E3A5F] bg-white/40 hover:bg-white/60",outline:"glass-button border border-[#1E3A5F]/30 text-[#1E3A5F] hover:bg-[#1E3A5F]/5",ghost:"text-[#1E3A5F] hover:bg-[#1E3A5F]/10",danger:"glass-button bg-gradient-to-r from-[#F56565] to-[#E53E3E] text-white border-0"}[r],{sm:"h-8 px-3 text-sm",md:"h-10 px-4 py-2",lg:"h-12 px-6 text-lg"}[i],a),disabled:o||d,...u,children:[d&&(0,s.jsx)(l.Z,{className:"mr-2 h-4 w-4 animate-spin"}),c]})});i.displayName="Button"},757:function(e,t,a){"use strict";a.d(t,{Z:function(){return l}});var s=a(7437),r=a(2265),n=a(3448);let l=(0,r.forwardRef)((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("glass rounded-2xl p-6 transition-all duration-300",a),...r})});l.displayName="Card"},2827:function(e,t,a){"use strict";a.d(t,{I:function(){return l}});var s=a(7437),r=a(2265),n=a(3448);let l=(0,r.forwardRef)((e,t)=>{let{className:a,error:r,label:l,...i}=e;return(0,s.jsxs)("div",{className:"w-full",children:[l&&(0,s.jsx)("label",{className:"block text-sm font-medium text-[#1A202C] mb-1.5",children:l}),(0,s.jsx)("input",{ref:t,className:(0,n.cn)("flex h-10 w-full rounded-lg border border-gray-200 bg-white/50 px-3 py-2 text-sm ring-offset-white file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-gray-400 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[#1E3A5F] disabled:cursor-not-allowed disabled:opacity-50 transition-all backdrop-blur-sm",r&&"border-[#F56565] focus-visible:ring-[#F56565]",a),...i}),r&&(0,s.jsx)("p",{className:"mt-1 text-sm text-[#F56565]",children:r})]})});l.displayName="Input"},3008:function(e,t,a){"use strict";a.d(t,{u:function(){return d}});var s=a(7437),r=a(2265),n=a(4887);let l=(0,a(8755).Z)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);var i=a(3448);function d(e){let{isOpen:t,onClose:a,title:d,children:c,className:o}=e;return((0,r.useEffect)(()=>(t?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[t]),t)?(0,n.createPortal)((0,s.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 sm:p-6 bg-black/40 backdrop-blur-sm animate-in fade-in duration-200",children:(0,s.jsxs)("div",{className:(0,i.cn)("relative w-full max-w-lg transform rounded-2xl bg-white/80 backdrop-blur-2xl p-6 text-left align-middle shadow-2xl transition-all animate-in zoom-in-95 duration-200 border border-white/40",o),children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[d&&(0,s.jsx)("h3",{className:"text-lg font-medium leading-6 text-[#161B33]",children:d}),(0,s.jsx)("button",{onClick:a,className:"rounded-full p-1 hover:bg-gray-100 transition-colors",children:(0,s.jsx)(l,{className:"h-5 w-5 text-gray-500"})})]}),(0,s.jsx)("div",{children:c})]})}),document.body):null}},4362:function(e,t,a){"use strict";a.d(t,{AuthProvider:function(){return o},a:function(){return u}});var s=a(7437),r=a(2265),n=a(1466),l=a(6943),i=a(6410),d=a(9376);let c=(0,r.createContext)({user:null,firebaseUser:null,loading:!0,emailVerified:!1,logout:async()=>{},refreshUser:async()=>{}});function o(e){let{children:t}=e,[a,o]=(0,r.useState)(null),[u,m]=(0,r.useState)(null),[x,h]=(0,r.useState)(!0),[p,f]=(0,r.useState)(!1),b=(0,d.useRouter)(),y=async e=>{try{let t=await (0,l.getDoc)((0,l.doc)(i.db,"users",e.uid));t.exists()?o({id:t.id,...t.data()}):o(null)}catch(e){console.error("Error fetching user data:",e),o(null)}};(0,r.useEffect)(()=>{let e=(0,n.Aj)(i.I,async e=>{m(e),e?(f(e.emailVerified),await y(e)):(o(null),f(!1)),h(!1)});return()=>e()},[]);let g=async()=>{await (0,n.w7)(i.I),o(null),m(null),f(!1),b.push("/login")},v=async()=>{let e=i.I.currentUser;e&&(await e.reload(),f(e.emailVerified),await y(e))};return(0,s.jsx)(c.Provider,{value:{user:a,firebaseUser:u,loading:x,emailVerified:p,logout:g,refreshUser:v},children:t})}let u=()=>(0,r.useContext)(c)},6410:function(e,t,a){"use strict";a.d(t,{I:function(){return i},V:function(){return c},db:function(){return d}});var s=a(738),r=a(1466),n=a(6943);let l=0===(0,s.C6)().length?(0,s.ZF)({apiKey:"AIzaSyDL2GylAt2YVRSstEpp4hucbcqw7RuVk4o",authDomain:"internship-matching-app.firebaseapp.com",projectId:"internship-matching-app",messagingSenderId:"299078518812",appId:"1:299078518812:web:03ad34bb4323c497a677d9"}):(0,s.C6)()[0],i=(0,r.v0)(l),d=(0,n.ad)(l),c=new r.hJ},3448:function(e,t,a){"use strict";a.d(t,{cn:function(){return n}});var s=a(1994),r=a(3335);function n(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,r.m6)((0,s.W)(t))}},4279:function(e,t,a){"use strict";a.d(t,{i:function(){return l}});var s=a(6410),r=a(6943);class n{async createReport(e,t,a,n,l,i){try{return(await (0,r.ET)((0,r.hJ)(s.db,"dailyReports"),{matchId:t,studentId:e,date:r.EK.fromDate(i),content:a,learning:n,nextGoals:l,createdAt:(0,r.Bt)(),updatedAt:(0,r.Bt)()})).id}catch(e){throw console.error("createReport error:",e),e}}async getReports(e){try{try{let t=(0,r.IO)((0,r.hJ)(s.db,"dailyReports"),(0,r.ar)("matchId","==",e),(0,r.Xo)("date","desc"));return(await (0,r.PL)(t)).docs.map(e=>({id:e.id,...e.data()}))}catch(a){var t;if("failed-precondition"===a.code||(null===(t=a.message)||void 0===t?void 0:t.includes("index"))){console.warn("Index missing for getReports, falling back to client-side sort");let t=(0,r.IO)((0,r.hJ)(s.db,"dailyReports"),(0,r.ar)("matchId","==",e));return(await (0,r.PL)(t)).docs.map(e=>({id:e.id,...e.data()})).sort((e,t)=>{var a,s;let r=(null===(a=e.date)||void 0===a?void 0:a.toMillis)?e.date.toMillis():e.date instanceof Date?e.date.getTime():0;return((null===(s=t.date)||void 0===s?void 0:s.toMillis)?t.date.toMillis():t.date instanceof Date?t.date.getTime():0)-r})}throw a}}catch(e){throw console.error("getReports error:",e),e}}async addCompanyComment(e,t){try{let a=(0,r.doc)(s.db,"dailyReports",e);await (0,r.r7)(a,{companyComment:t,updatedAt:(0,r.Bt)()})}catch(e){throw console.error("addCompanyComment error:",e),e}}async getMatch(e){try{let t=await (0,r.getDoc)((0,r.doc)(s.db,"matches",e));if(t.exists())return{id:t.id,...t.data()};return null}catch(e){throw console.error("getMatch error:",e),e}}async completeInternship(e){try{await (0,r.r7)((0,r.doc)(s.db,"matches",e),{status:"completed",endDate:(0,r.Bt)()})}catch(e){throw console.error("completeInternship error:",e),e}}async submitEvaluation(e,t,a,n,l){try{await (0,r.ET)((0,r.hJ)(s.db,"evaluations"),{matchId:e,fromId:t,toId:a,score:n,comment:l,createdAt:(0,r.Bt)()})}catch(e){throw console.error("submitEvaluation error:",e),e}}async getEvaluation(e,t){try{let a=(0,r.IO)((0,r.hJ)(s.db,"evaluations"),(0,r.ar)("matchId","==",e),(0,r.ar)("fromId","==",t)),n=await (0,r.PL)(a);if(!n.empty)return{id:n.docs[0].id,...n.docs[0].data()};return null}catch(e){throw console.error("getEvaluation error:",e),e}}}let l=new n}},function(e){e.O(0,[287,8483,1442,8697,1787,9814,2971,2117,1744],function(){return e(e.s=6559)}),_N_E=e.O()}]);