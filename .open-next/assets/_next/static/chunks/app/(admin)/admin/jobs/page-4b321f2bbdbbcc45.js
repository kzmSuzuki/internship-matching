(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3123],{5163:function(e,t,a){Promise.resolve().then(a.bind(a,3141))},44:function(e,t,a){"use strict";a.d(t,{Z:function(){return n}});let n=(0,a(8755).Z)("building",[["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M9 22v-3a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v3",key:"cabbwy"}],["rect",{x:"4",y:"2",width:"16",height:"20",rx:"2",key:"1uxh74"}]])},1047:function(e,t,a){"use strict";a.d(t,{Z:function(){return n}});let n=(0,a(8755).Z)("calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]])},6362:function(e,t,a){"use strict";a.d(t,{Z:function(){return n}});let n=(0,a(8755).Z)("external-link",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]])},3774:function(e,t,a){"use strict";a.d(t,{Z:function(){return n}});let n=(0,a(8755).Z)("map-pin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]])},5868:function(e,t,a){"use strict";a.d(t,{Z:function(){return n}});let n=(0,a(8755).Z)("square-pen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]])},8930:function(e,t,a){"use strict";a.d(t,{Z:function(){return n}});let n=(0,a(8755).Z)("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]])},3141:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return w}});var n=a(7437),s=a(2265),i=a(6943),r=a(6410),l=a(3880),d=a(757),o=a(6334),c=a(8711),u=a(1817),p=a(44),m=a(3774),h=a(1047),x=a(5868),g=a(8930),f=a(6362),y=a(6424),b=a(3008),v=a(7648);function w(){let[e,t]=(0,s.useState)([]),[a,w]=(0,s.useState)(!0),[j,N]=(0,s.useState)(null),[k,A]=(0,s.useState)(null),[C,I]=(0,s.useState)("all"),[E,M]=(0,s.useState)(""),F=async()=>{w(!0);try{let e=await l.d.getAllJobs(),a=await Promise.all(e.map(async e=>{if(e.companyName)return{...e,resolvedCompanyName:e.companyName};try{let t=await (0,i.getDoc)((0,i.doc)(r.db,"companies",e.companyId)),a=t.exists()?t.data().name:e.companyId;return{...e,resolvedCompanyName:a}}catch(t){return{...e,resolvedCompanyName:e.companyId}}}));t(a)}catch(e){console.error(e)}finally{w(!1)}};(0,s.useEffect)(()=>{F()},[]);let P=async e=>{if(confirm("この求人を承認して公開しますか？")){A(e);try{await l.d.approveJob(e),t(t=>t.map(t=>t.id===e?{...t,status:"published"}:t)),N(null)}catch(e){console.error(e),alert("承認に失敗しました")}finally{A(null)}}},z=async e=>{if(confirm("この求人を差し戻しますか？（下書き状態に戻ります）")){A(e);try{await l.d.rejectJob(e),t(t=>t.map(t=>t.id===e?{...t,status:"draft"}:t)),N(null)}catch(e){console.error(e),alert("差し戻しに失敗しました")}finally{A(null)}}},J=async e=>{let t=window.open("","_blank");t&&t.document.write('<div style="display:flex;justify-content:center;align-items:center;height:100vh;font-family:sans-serif;">Loading PDF...</div>'),A("pdf-".concat(e));try{if(!r.I.currentUser)return;let a=await r.I.currentUser.getIdToken(),n=await fetch("/api/pdf/".concat(e),{headers:{Authorization:"Bearer ".concat(a)}});if(!n.ok){let e=await n.json();throw Error(e.error||"PDFの取得に失敗しました")}let s=await n.blob(),i=URL.createObjectURL(s);t?t.location.href=i:window.open(i,"_blank")}catch(e){console.error(e),t&&t.close(),alert("PDFを表示できませんでした: "+e.message)}finally{A(null)}},Z=async e=>{if(window.confirm("この求人を削除してもよろしいですか？取り消せません。"))try{await (0,i.oe)((0,i.doc)(r.db,"jobPostings",e)),t(t=>t.filter(t=>t.id!==e))}catch(e){console.error("Delete error:",e),alert("削除に失敗しました")}},D=e.filter(e=>{let t=!0===e.isDeleted;if("pending"===C){if(t||"pending_approval"!==e.status)return!1}else if("published"===C&&(t||"published"!==e.status))return!1;if(E){var a;let t=E.toLowerCase(),n=e.title.toLowerCase().includes(t),s=(null===(a=e.resolvedCompanyName)||void 0===a?void 0:a.toLowerCase().includes(t))||!1,i=e.location.toLowerCase().includes(t);return n||s||i}return!0});return a?(0,n.jsx)("div",{className:"flex justify-center p-12",children:(0,n.jsx)(u.Z,{className:"animate-spin text-[#1E3A5F]"})}):(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsxs)("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h1",{className:"text-2xl font-bold text-[#1E3A5F]",children:"求人管理"}),(0,n.jsx)("p",{className:"text-gray-500",children:"全ての求人を管理・承認できます"})]}),(0,n.jsxs)("div",{className:"flex flex-col md:flex-row gap-4 w-full md:w-auto",children:[(0,n.jsx)("input",{type:"text",placeholder:"求人名・企業名・場所で検索...",className:"border border-gray-300 rounded-lg px-4 py-2 text-sm w-full md:w-64 focus:outline-none focus:ring-2 focus:ring-[#1E3A5F]",value:E,onChange:e=>M(e.target.value)}),(0,n.jsxs)("div",{className:"flex bg-gray-100 p-1 rounded-lg self-start",children:[(0,n.jsx)("button",{className:"px-4 py-1.5 rounded-md text-sm font-medium transition-colors ".concat("pending"===C?"bg-white shadow text-[#1E3A5F]":"text-gray-500 hover:text-gray-700"),onClick:()=>I("pending"),children:"承認待ち"}),(0,n.jsx)("button",{className:"px-4 py-1.5 rounded-md text-sm font-medium transition-colors ".concat("published"===C?"bg-white shadow text-[#1E3A5F]":"text-gray-500 hover:text-gray-700"),onClick:()=>I("published"),children:"公開中"}),(0,n.jsx)("button",{className:"px-4 py-1.5 rounded-md text-sm font-medium transition-colors ".concat("all"===C?"bg-white shadow text-[#1E3A5F]":"text-gray-500 hover:text-gray-700"),onClick:()=>I("all"),children:"すべて"})]})]})]}),0===D.length?(0,n.jsx)(d.Z,{className:"p-12 text-center text-gray-500",children:"該当する求人はありません。"}):(0,n.jsx)("div",{className:"grid gap-4",children:D.map(e=>{var t;let a=!0===e.isDeleted;return(0,n.jsx)(d.Z,{className:"p-6 ".concat(a?"!bg-gray-300 !border-gray-400 !shadow-none !backdrop-blur-none":""),children:(0,n.jsxs)("div",{className:"flex justify-between items-start",children:[(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:["pending_approval"===e.status&&(0,n.jsx)(c.C,{variant:"warning",children:"承認待ち"}),"published"===e.status&&(0,n.jsx)(c.C,{variant:"success",children:"公開中"}),"draft"===e.status&&(0,n.jsx)(c.C,{variant:"outline",children:"下書き"}),"closed"===e.status&&(0,n.jsx)(c.C,{variant:"error",className:"bg-gray-100 text-gray-500",children:"終了"})]}),(0,n.jsxs)("h3",{className:"text-xl font-bold mb-1 flex items-center gap-2",children:[e.title,a&&(0,n.jsx)(c.C,{variant:"danger",className:"text-xs",children:"削除済み"})]}),(0,n.jsxs)("div",{className:"flex items-center gap-4 text-sm text-gray-600 mb-4",children:[(0,n.jsxs)("span",{className:"flex items-center gap-1",children:[(0,n.jsx)(p.Z,{size:14,className:"text-[#1E3A5F]"})," ",e.resolvedCompanyName]}),(0,n.jsxs)("span",{className:"flex items-center gap-1",children:[(0,n.jsx)(m.Z,{size:14})," ",e.location]}),(0,n.jsxs)("span",{className:"flex items-center gap-1",children:[(0,n.jsx)(h.Z,{size:14})," ",(null===(t=e.createdAt)||void 0===t?void 0:t.toDate)?(0,y.WU)(e.createdAt.toDate(),"yyyy/MM/dd HH:mm"):"-"]})]}),(0,n.jsx)("div",{className:"flex gap-2 mb-2",children:e.requirements.map((e,t)=>(0,n.jsx)(c.C,{variant:"outline",className:"bg-gray-50",children:e},t))})]}),(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsx)(v.default,{href:"/company/jobs/".concat(e.id,"/edit"),children:(0,n.jsx)(o.z,{variant:"secondary",size:"sm",className:"px-3",children:(0,n.jsx)(x.Z,{size:16})})})," ",(0,n.jsx)(o.z,{variant:"ghost",size:"sm",className:"text-red-500 hover:bg-red-50 px-3",onClick:()=>Z(e.id),children:(0,n.jsx)(g.Z,{size:16})}),(0,n.jsx)(o.z,{variant:"outline",onClick:()=>N(e),children:"詳細確認"}),"pending_approval"===e.status&&(0,n.jsx)(o.z,{className:"bg-[#1E3A5F] hover:bg-[#16304F]",isLoading:k===e.id,onClick:()=>P(e.id),children:"承認"})]})]})},e.id)})}),(0,n.jsx)(b.u,{isOpen:!!j,onClose:()=>N(null),title:"求人詳細",children:j&&(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h2",{className:"text-xl font-bold mb-2",children:j.title}),(0,n.jsxs)("div",{className:"flex gap-2 mb-4 items-center",children:["pending_approval"===j.status&&(0,n.jsx)(c.C,{variant:"warning",children:"承認待ち"}),"published"===j.status&&(0,n.jsx)(c.C,{variant:"success",children:"公開中"}),(0,n.jsxs)("span",{className:"text-sm text-gray-600 flex items-center gap-1",children:[(0,n.jsx)(p.Z,{size:14,className:"text-[#1E3A5F]"}),j.resolvedCompanyName]})]})]}),(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[(0,n.jsxs)("div",{className:"bg-gray-50 p-3 rounded-lg",children:[(0,n.jsx)("label",{className:"text-xs text-gray-400 block mb-1",children:"勤務地"}),(0,n.jsxs)("p",{className:"flex items-center gap-1",children:[(0,n.jsx)(m.Z,{size:14})," ",j.location]})]}),j.salary&&(0,n.jsxs)("div",{className:"bg-gray-50 p-3 rounded-lg",children:[(0,n.jsx)("label",{className:"text-xs text-gray-400 block mb-1",children:"給与/待遇"}),(0,n.jsx)("p",{children:j.salary})]})]}),j.requirements.length>0&&(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"text-xs text-gray-400 block mb-1",children:"応募要件"}),(0,n.jsx)("div",{className:"flex flex-wrap gap-2",children:j.requirements.map((e,t)=>(0,n.jsx)(c.C,{variant:"outline",className:"bg-gray-50",children:e},t))})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"text-xs text-gray-500 block mb-1",children:"募集内容"}),(0,n.jsx)("div",{className:"p-4 bg-gray-50 rounded-lg whitespace-pre-wrap text-sm",children:j.content||"（テキスト説明なし）"}),j.pdfFileId&&(0,n.jsx)("div",{className:"mt-4 border-t pt-4",children:(0,n.jsxs)(o.z,{onClick:()=>J(j.pdfFileId),variant:"secondary",className:"w-full flex justify-center items-center gap-2",isLoading:k==="pdf-".concat(j.pdfFileId),children:[(0,n.jsx)(f.Z,{size:16})," 募集要項PDFを確認する"]})})]}),(0,n.jsxs)("div",{className:"flex justify-end gap-3 pt-4 border-t",children:["pending_approval"===j.status&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(o.z,{variant:"outline",className:"text-[#F56565] border-[#F56565] hover:bg-[#F56565]/10",onClick:()=>z(j.id),isLoading:k===j.id,children:"差し戻し"}),(0,n.jsx)(o.z,{className:"bg-[#1E3A5F] hover:bg-[#16304F]",onClick:()=>P(j.id),isLoading:k===j.id,children:"承認して公開"})]}),"published"===j.status&&(0,n.jsx)(o.z,{variant:"outline",onClick:()=>N(null),children:"閉じる"})]})]})})]})}},8711:function(e,t,a){"use strict";a.d(t,{C:function(){return r}});var n=a(7437),s=a(2265),i=a(3448);let r=(0,s.forwardRef)((e,t)=>{let{className:a,variant:s="default",...r}=e;return(0,n.jsx)("span",{ref:t,className:(0,i.cn)("inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium transition-colors",{default:"bg-[#1E3A5F]/10 text-[#161B33]",success:"bg-[#48BB78]/10 text-[#48BB78]",warning:"bg-[#ED8936]/10 text-[#ED8936]",error:"bg-[#F56565]/10 text-[#F56565]",outline:"border border-gray-200 text-gray-500"}[s],a),...r})});r.displayName="Badge"},6334:function(e,t,a){"use strict";a.d(t,{z:function(){return l}});var n=a(7437),s=a(2265),i=a(3448),r=a(1817);let l=(0,s.forwardRef)((e,t)=>{let{className:a,variant:s="primary",size:l="md",isLoading:d,children:o,disabled:c,...u}=e;return(0,n.jsxs)("button",{ref:t,className:(0,i.cn)("inline-flex items-center justify-center rounded-lg font-medium transition-all focus:outline-none focus:ring-2 focus:ring-[#1E3A5F]/50 disabled:opacity-50 disabled:cursor-not-allowed",{primary:"bg-gradient-to-r from-[#161B33] to-[#142841] text-white shadow-lg hover:shadow-xl hover:-translate-y-0.5 transition-all duration-300 border border-white/10",secondary:"glass-button text-[#1E3A5F] bg-white/40 hover:bg-white/60",outline:"glass-button border border-[#1E3A5F]/30 text-[#1E3A5F] hover:bg-[#1E3A5F]/5",ghost:"text-[#1E3A5F] hover:bg-[#1E3A5F]/10",danger:"glass-button bg-gradient-to-r from-[#F56565] to-[#E53E3E] text-white border-0"}[s],{sm:"h-8 px-3 text-sm",md:"h-10 px-4 py-2",lg:"h-12 px-6 text-lg"}[l],a),disabled:c||d,...u,children:[d&&(0,n.jsx)(r.Z,{className:"mr-2 h-4 w-4 animate-spin"}),o]})});l.displayName="Button"},757:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});var n=a(7437),s=a(2265),i=a(3448);let r=(0,s.forwardRef)((e,t)=>{let{className:a,...s}=e;return(0,n.jsx)("div",{ref:t,className:(0,i.cn)("glass rounded-2xl p-6 transition-all duration-300",a),...s})});r.displayName="Card"},3008:function(e,t,a){"use strict";a.d(t,{u:function(){return d}});var n=a(7437),s=a(2265),i=a(4887);let r=(0,a(8755).Z)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);var l=a(3448);function d(e){let{isOpen:t,onClose:a,title:d,children:o,className:c}=e;return((0,s.useEffect)(()=>(t?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[t]),t)?(0,i.createPortal)((0,n.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 sm:p-6 bg-black/40 backdrop-blur-sm animate-in fade-in duration-200",children:(0,n.jsxs)("div",{className:(0,l.cn)("relative w-full max-w-lg transform rounded-2xl bg-white/80 backdrop-blur-2xl p-6 text-left align-middle shadow-2xl transition-all animate-in zoom-in-95 duration-200 border border-white/40",c),children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[d&&(0,n.jsx)("h3",{className:"text-lg font-medium leading-6 text-[#161B33]",children:d}),(0,n.jsx)("button",{onClick:a,className:"rounded-full p-1 hover:bg-gray-100 transition-colors",children:(0,n.jsx)(r,{className:"h-5 w-5 text-gray-500"})})]}),(0,n.jsx)("div",{children:o})]})}),document.body):null}},6410:function(e,t,a){"use strict";a.d(t,{I:function(){return l},V:function(){return o},db:function(){return d}});var n=a(738),s=a(1466),i=a(6943);let r=0===(0,n.C6)().length?(0,n.ZF)({apiKey:"AIzaSyDL2GylAt2YVRSstEpp4hucbcqw7RuVk4o",authDomain:"internship-matching-app.firebaseapp.com",projectId:"internship-matching-app",messagingSenderId:"299078518812",appId:"1:299078518812:web:03ad34bb4323c497a677d9"}):(0,n.C6)()[0],l=(0,s.v0)(r),d=(0,i.ad)(r),o=new s.hJ},1677:function(e,t,a){"use strict";async function n(e,t,a){try{let n=await fetch("/api/send-email",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({to:e,subject:t,body:a})});if(!n.ok)return console.error("Failed to send email:",await n.text()),!1;return!0}catch(e){return console.error("Error sending email:",e),!1}}a.d(t,{C:function(){return n}})},3448:function(e,t,a){"use strict";a.d(t,{cn:function(){return i}});var n=a(1994),s=a(3335);function i(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,s.m6)((0,n.W)(t))}},3880:function(e,t,a){"use strict";a.d(t,{d:function(){return d}});var n=a(6410),s=a(6943),i=a(1437),r=a(1677);class l{async getUserEmail(e){try{let t=await (0,s.getDoc)((0,s.doc)(n.db,"users",e));if(t.exists())return t.data().email}catch(e){console.error("Error fetching user email:",e)}return null}async getStats(){try{let e=(0,s.hJ)(n.db,"users"),t=(0,s.hJ)(n.db,"companies"),a=(0,s.hJ)(n.db,"jobPostings"),i=(0,s.hJ)(n.db,"applications"),r=(0,s.hJ)(n.db,"matches"),l=await (0,s.Yp)((0,s.IO)(e,(0,s.ar)("role","==","student"))),d=await (0,s.Yp)(t),o=await (0,s.Yp)((0,s.IO)(a,(0,s.ar)("status","==","pending_approval"))),c=await (0,s.Yp)((0,s.IO)(a,(0,s.ar)("status","==","published"))),u=await (0,s.Yp)((0,s.IO)(i,(0,s.ar)("status","==","pending_admin"))),p=await (0,s.Yp)(r),m=await (0,s.Yp)((0,s.IO)(t,(0,s.ar)("isApproved","==",!1)));return{totalUsers:l.data().count,totalCompanies:d.data().count,pendingCompanies:m.data().count,pendingJobs:o.data().count,activeJobs:c.data().count,pendingApplications:u.data().count,totalMatches:p.data().count}}catch(e){throw console.error("AdminService.getStats error:",e),e}}async getPendingJobs(){try{let e=(0,s.IO)((0,s.hJ)(n.db,"jobPostings"),(0,s.ar)("status","==","pending_approval"),(0,s.Xo)("createdAt","asc"));return(await (0,s.PL)(e)).docs.map(e=>({id:e.id,...e.data()}))}catch(t){var e;if("failed-precondition"===t.code||(null===(e=t.message)||void 0===e?void 0:e.includes("index"))){console.warn("Composite index missing for getPendingJobs, falling back to unordered query. Create the index in Firebase Console.");let e=(0,s.IO)((0,s.hJ)(n.db,"jobPostings"),(0,s.ar)("status","==","pending_approval"));return(await (0,s.PL)(e)).docs.map(e=>({id:e.id,...e.data()})).sort((e,t)=>{var a,n,s,i,r,l;return(null!==(r=null===(n=e.createdAt)||void 0===n?void 0:null===(a=n.toMillis)||void 0===a?void 0:a.call(n))&&void 0!==r?r:0)-(null!==(l=null===(i=t.createdAt)||void 0===i?void 0:null===(s=i.toMillis)||void 0===s?void 0:s.call(i))&&void 0!==l?l:0)})}throw t}}async getAllJobs(){let e=(0,s.IO)((0,s.hJ)(n.db,"jobPostings"),(0,s.Xo)("createdAt","desc"));return(await (0,s.PL)(e)).docs.map(e=>({id:e.id,...e.data()}))}async approveJob(e){let t=(0,s.doc)(n.db,"jobPostings",e),a=await (0,s.getDoc)(t);if(!a.exists())return;let l=a.data();if(await (0,s.r7)(t,{status:"published",updatedAt:(0,s.Bt)()}),null==l?void 0:l.companyId){await i.B.createNotification(l.companyId,"求人が承認されました","求人「".concat(l.title,"」が公開されました。"),"job_approved_admin","/company/jobs/".concat(e));let t=await this.getUserEmail(l.companyId);t&&await (0,r.C)(t,"【Internship Match】求人公開のお知らせ","求人「".concat(l.title,"」が承認され、公開されました。\n\nマイページから確認できます。"))}}async rejectJob(e){let t=(0,s.doc)(n.db,"jobPostings",e),a=await (0,s.getDoc)(t),l=a.exists()?a.data():null;if(await (0,s.r7)(t,{status:"draft",updatedAt:(0,s.Bt)()}),null==l?void 0:l.companyId){await i.B.createNotification(l.companyId,"求人が差し戻されました","求人「".concat(l.title,"」の内容を確認してください。"),"system","/company/jobs/".concat(e));let t=await this.getUserEmail(l.companyId);t&&await (0,r.C)(t,"【Internship Match】求人差し戻しのお知らせ","求人「".concat(l.title,"」が差し戻されました。\n理由を確認し、内容を修正してください。"))}}async getAllCompanies(){return(await (0,s.PL)((0,s.hJ)(n.db,"companies"))).docs.map(e=>({userId:e.id,...e.data()}))}async approveCompany(e){await (0,s.r7)((0,s.doc)(n.db,"companies",e),{isApproved:!0,updatedAt:(0,s.Bt)()}),await i.B.createNotification(e,"企業アカウントが承認されました","アカウント審査が完了しました。求人の作成が可能です。","system","/company/dashboard");let t=await this.getUserEmail(e);t&&await (0,r.C)(t,"【Internship Match】企業アカウント承認のお知らせ","アカウント審査が完了しました。\n本日より求人の作成が可能になります。\n\nダッシュボードにログインしてご利用を開始してください。")}async revokeCompany(e){await (0,s.r7)((0,s.doc)(n.db,"companies",e),{isApproved:!1,updatedAt:(0,s.Bt)()})}async getPendingApplications(){try{let e=(0,s.IO)((0,s.hJ)(n.db,"applications"),(0,s.ar)("status","==","pending_admin"),(0,s.Xo)("createdAt","asc"));return(await (0,s.PL)(e)).docs.map(e=>({id:e.id,...e.data()}))}catch(t){var e;if("failed-precondition"===t.code||(null===(e=t.message)||void 0===e?void 0:e.includes("index"))){console.warn("Composite index missing for getPendingApplications, falling back.");let e=(0,s.IO)((0,s.hJ)(n.db,"applications"),(0,s.ar)("status","==","pending_admin"));return(await (0,s.PL)(e)).docs.map(e=>({id:e.id,...e.data()})).sort((e,t)=>{var a,n,s,i,r,l;return(null!==(r=null===(n=e.createdAt)||void 0===n?void 0:null===(a=n.toMillis)||void 0===a?void 0:a.call(n))&&void 0!==r?r:0)-(null!==(l=null===(i=t.createdAt)||void 0===i?void 0:null===(s=i.toMillis)||void 0===s?void 0:s.call(i))&&void 0!==l?l:0)})}throw t}}async getApplicationDetails(e){let t=await (0,s.getDoc)((0,s.doc)(n.db,"jobPostings",e.jobId)),a=await (0,s.getDoc)((0,s.doc)(n.db,"students",e.studentId)),i=await (0,s.getDoc)((0,s.doc)(n.db,"companies",e.companyId));return{job:t.exists()?t.data():null,student:a.exists()?a.data():null,company:i.exists()?i.data():null}}async approveApplication(e){}async getAllMatches(){try{let e=(0,s.IO)((0,s.hJ)(n.db,"matches"),(0,s.Xo)("createdAt","desc")),t=(await (0,s.PL)(e)).docs.map(e=>({id:e.id,...e.data()}));return await Promise.all(t.map(async e=>{let t=await (0,s.getDoc)((0,s.doc)(n.db,"students",e.studentId)),a=await (0,s.getDoc)((0,s.doc)(n.db,"companies",e.companyId)),i=await (0,s.getDoc)((0,s.doc)(n.db,"jobPostings",e.jobId));return{...e,studentName:t.exists()?t.data().name:"退会済みユーザー",companyName:a.exists()?a.data().name:"不明な企業",jobTitle:i.exists()?i.data().title:"削除された求人"}}))}catch(e){throw console.error("getAllMatches error:",e),e}}async getMatchEvaluations(e){try{let t=(0,s.IO)((0,s.hJ)(n.db,"evaluations"),(0,s.ar)("matchId","==",e));return(await (0,s.PL)(t)).docs.map(e=>({id:e.id,...e.data()}))}catch(e){return console.error(e),[]}}}let d=new l},1437:function(e,t,a){"use strict";a.d(t,{B:function(){return r}});var n=a(6410),s=a(6943);a(2265);class i{async markAsRead(e){let t=(0,s.doc)(n.db,"notifications",e);await (0,s.r7)(t,{read:!0,updatedAt:(0,s.Bt)()})}async markAllAsRead(e){let t=(0,s.IO)((0,s.hJ)(n.db,"notifications"),(0,s.ar)("userId","==",e),(0,s.ar)("read","==",!1)),a=await (0,s.PL)(t);if(a.empty)return;let i=(0,s.qs)(n.db);a.docs.forEach(e=>{i.update(e.ref,{read:!0,updatedAt:(0,s.Bt)()})}),await i.commit()}async createNotification(e,t,a,i,r){try{await (0,s.ET)((0,s.hJ)(n.db,"notifications"),{userId:e,title:t,message:a,type:i,link:r,read:!1,createdAt:(0,s.Bt)()})}catch(e){console.error("Error creating notification:",e)}}}let r=new i}},function(e){e.O(0,[287,8483,1442,8697,7648,6165,2971,2117,1744],function(){return e(e.s=5163)}),_N_E=e.O()}]);