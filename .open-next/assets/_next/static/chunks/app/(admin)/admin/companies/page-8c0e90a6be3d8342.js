(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8820],{4441:function(e,t,a){Promise.resolve().then(a.bind(a,4313))},44:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});let s=(0,a(8755).Z)("building",[["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M9 22v-3a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v3",key:"cabbwy"}],["rect",{x:"4",y:"2",width:"16",height:"20",rx:"2",key:"1uxh74"}]])},1817:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});let s=(0,a(8755).Z)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},3774:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});let s=(0,a(8755).Z)("map-pin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]])},4313:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return h}});var s=a(7437),n=a(2265),i=a(3880),r=a(757),d=a(8711),l=a(1817),o=a(44),c=a(3774);let u=(0,a(8755).Z)("globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);var p=a(3008),m=a(6334);function h(){let[e,t]=(0,n.useState)([]),[a,h]=(0,n.useState)(!0),[x,f]=(0,n.useState)(null),[b,g]=(0,n.useState)(null),[y,v]=(0,n.useState)(""),j=async()=>{try{let e=await i.d.getAllCompanies();t(e)}catch(e){console.error(e)}finally{h(!1)}};(0,n.useEffect)(()=>{j()},[]);let w=async e=>{if(confirm("この企業を承認しますか？求人の作成が可能になります。")){g(e);try{await i.d.approveCompany(e),t(t=>t.map(t=>t.userId===e?{...t,isApproved:!0}:t)),f(t=>t&&t.userId===e?{...t,isApproved:!0}:t)}catch(e){console.error(e),alert("承認に失敗しました")}finally{g(null)}}},N=async e=>{if(confirm("この企業の承認を取り消しますか？求人の作成ができなくなります。")){g(e);try{await i.d.revokeCompany(e),t(t=>t.map(t=>t.userId===e?{...t,isApproved:!1}:t)),f(t=>t&&t.userId===e?{...t,isApproved:!1}:t)}catch(e){console.error(e),alert("取消に失敗しました")}finally{g(null)}}};if(a)return(0,s.jsx)("div",{className:"flex justify-center p-12",children:(0,s.jsx)(l.Z,{className:"animate-spin text-[#1E3A5F]"})});let A=e.filter(e=>{var t,a;if(!y)return!0;let s=y.toLowerCase(),n=(null===(t=e.name)||void 0===t?void 0:t.toLowerCase())||"",i=(null===(a=e.industry)||void 0===a?void 0:a.toLowerCase())||"";return n.includes(s)||i.includes(s)}),I=A.filter(e=>!e.isApproved),k=A.filter(e=>e.isApproved);return(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-[#1E3A5F]",children:"企業管理"}),(0,s.jsxs)("p",{className:"text-gray-500",children:["登録企業: ",e.length," 社（表示: ",A.length," 社）"]})]}),(0,s.jsx)("input",{type:"text",placeholder:"企業名・業種で検索...",className:"border border-gray-300 rounded-lg px-4 py-2 text-sm w-full md:w-64 focus:outline-none focus:ring-2 focus:ring-[#1E3A5F]",value:y,onChange:e=>v(e.target.value)})]}),I.length>0&&(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsx)("h2",{className:"text-lg font-bold text-amber-700",children:"⏳ 承認待ちの企業"}),(0,s.jsx)("div",{className:"grid gap-4",children:I.map(e=>(0,s.jsx)(r.Z,{className:"p-6 border-l-4 border-l-amber-400",children:(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsx)("div",{className:"w-12 h-12 bg-[#1E3A5F]/10 rounded-full flex items-center justify-center",children:(0,s.jsx)(o.Z,{className:"text-[#1E3A5F]"})}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("h3",{className:"font-bold text-lg",children:e.name}),(0,s.jsxs)("div",{className:"flex gap-4 text-sm text-gray-500",children:[e.industry&&(0,s.jsx)("span",{children:e.industry}),e.address&&(0,s.jsxs)("span",{className:"flex items-center gap-1",children:[(0,s.jsx)(c.Z,{size:14})," ",e.address]})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(d.C,{variant:"warning",children:"承認待ち"}),(0,s.jsx)(m.z,{size:"sm",variant:"outline",onClick:()=>f(e),children:"詳細"}),(0,s.jsx)(m.z,{size:"sm",onClick:()=>w(e.userId),isLoading:b===e.userId,children:"承認する"})]})]})},e.userId))})]}),k.length>0&&(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsx)("h2",{className:"text-lg font-bold text-[#1E3A5F]",children:"✅ 承認済みの企業"}),(0,s.jsx)("div",{className:"grid gap-4",children:k.map(e=>(0,s.jsx)(r.Z,{className:"p-6 cursor-pointer hover:bg-gray-50 transition-colors",onClick:()=>f(e),children:(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsx)("div",{className:"w-12 h-12 bg-[#1E3A5F]/10 rounded-full flex items-center justify-center",children:(0,s.jsx)(o.Z,{className:"text-[#1E3A5F]"})}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("h3",{className:"font-bold text-lg",children:e.name}),(0,s.jsxs)("div",{className:"flex gap-4 text-sm text-gray-500",children:[e.industry&&(0,s.jsx)("span",{children:e.industry}),e.address&&(0,s.jsxs)("span",{className:"flex items-center gap-1",children:[(0,s.jsx)(c.Z,{size:14})," ",e.address]})]})]}),(0,s.jsx)(d.C,{variant:"success",children:"承認済み"})]})},e.userId))})]}),(0,s.jsx)(p.u,{isOpen:!!x,onClose:()=>f(null),title:"企業詳細",children:x&&(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("h2",{className:"text-xl font-bold",children:x.name}),(0,s.jsx)(d.C,{variant:x.isApproved?"success":"warning",children:x.isApproved?"承認済み":"承認待ち"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-xs text-gray-400 block",children:"業種"}),(0,s.jsx)("p",{children:x.industry||"未設定"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-xs text-gray-400 block",children:"Webサイト"}),x.website?(0,s.jsxs)("a",{href:x.website,target:"_blank",className:"text-[#1E3A5F] hover:underline flex items-center gap-1",children:[(0,s.jsx)(u,{size:14})," ",x.website]}):(0,s.jsx)("p",{className:"text-gray-400",children:"未設定"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-xs text-gray-400 block",children:"住所"}),(0,s.jsx)("p",{children:x.address||"未設定"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-xs text-gray-400 block",children:"会社概要"}),(0,s.jsx)("p",{className:"text-sm bg-gray-50 p-2 rounded whitespace-pre-wrap",children:x.description||"未設定"})]}),(0,s.jsxs)("div",{className:"pt-4 flex justify-end gap-3 border-t",children:[x.isApproved?(0,s.jsx)(m.z,{variant:"danger",onClick:()=>N(x.userId),isLoading:b===x.userId,className:"text-[#f56565]",children:"承認を取消"}):(0,s.jsx)(m.z,{onClick:()=>w(x.userId),isLoading:b===x.userId,children:"承認する"}),(0,s.jsx)(m.z,{variant:"secondary",onClick:()=>f(null),children:"閉じる"})]})]})})]})}},8711:function(e,t,a){"use strict";a.d(t,{C:function(){return r}});var s=a(7437),n=a(2265),i=a(3448);let r=(0,n.forwardRef)((e,t)=>{let{className:a,variant:n="default",...r}=e;return(0,s.jsx)("span",{ref:t,className:(0,i.cn)("inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium transition-colors",{default:"bg-[#1E3A5F]/10 text-[#161B33]",success:"bg-[#48BB78]/10 text-[#48BB78]",warning:"bg-[#ED8936]/10 text-[#ED8936]",error:"bg-[#F56565]/10 text-[#F56565]",outline:"border border-gray-200 text-gray-500"}[n],a),...r})});r.displayName="Badge"},6334:function(e,t,a){"use strict";a.d(t,{z:function(){return d}});var s=a(7437),n=a(2265),i=a(3448),r=a(1817);let d=(0,n.forwardRef)((e,t)=>{let{className:a,variant:n="primary",size:d="md",isLoading:l,children:o,disabled:c,...u}=e;return(0,s.jsxs)("button",{ref:t,className:(0,i.cn)("inline-flex items-center justify-center rounded-lg font-medium transition-all focus:outline-none focus:ring-2 focus:ring-[#1E3A5F]/50 disabled:opacity-50 disabled:cursor-not-allowed",{primary:"bg-gradient-to-r from-[#161B33] to-[#142841] text-white shadow-lg hover:shadow-xl hover:-translate-y-0.5 transition-all duration-300 border border-white/10",secondary:"glass-button text-[#1E3A5F] bg-white/40 hover:bg-white/60",outline:"glass-button border border-[#1E3A5F]/30 text-[#1E3A5F] hover:bg-[#1E3A5F]/5",ghost:"text-[#1E3A5F] hover:bg-[#1E3A5F]/10",danger:"glass-button bg-gradient-to-r from-[#F56565] to-[#E53E3E] text-white border-0"}[n],{sm:"h-8 px-3 text-sm",md:"h-10 px-4 py-2",lg:"h-12 px-6 text-lg"}[d],a),disabled:c||l,...u,children:[l&&(0,s.jsx)(r.Z,{className:"mr-2 h-4 w-4 animate-spin"}),o]})});d.displayName="Button"},757:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});var s=a(7437),n=a(2265),i=a(3448);let r=(0,n.forwardRef)((e,t)=>{let{className:a,...n}=e;return(0,s.jsx)("div",{ref:t,className:(0,i.cn)("glass rounded-2xl p-6 transition-all duration-300",a),...n})});r.displayName="Card"},3008:function(e,t,a){"use strict";a.d(t,{u:function(){return l}});var s=a(7437),n=a(2265),i=a(4887);let r=(0,a(8755).Z)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);var d=a(3448);function l(e){let{isOpen:t,onClose:a,title:l,children:o,className:c}=e;return((0,n.useEffect)(()=>(t?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[t]),t)?(0,i.createPortal)((0,s.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 sm:p-6 bg-black/40 backdrop-blur-sm animate-in fade-in duration-200",children:(0,s.jsxs)("div",{className:(0,d.cn)("relative w-full max-w-lg transform rounded-2xl bg-white/80 backdrop-blur-2xl p-6 text-left align-middle shadow-2xl transition-all animate-in zoom-in-95 duration-200 border border-white/40",c),children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[l&&(0,s.jsx)("h3",{className:"text-lg font-medium leading-6 text-[#161B33]",children:l}),(0,s.jsx)("button",{onClick:a,className:"rounded-full p-1 hover:bg-gray-100 transition-colors",children:(0,s.jsx)(r,{className:"h-5 w-5 text-gray-500"})})]}),(0,s.jsx)("div",{children:o})]})}),document.body):null}},6410:function(e,t,a){"use strict";a.d(t,{I:function(){return d},V:function(){return o},db:function(){return l}});var s=a(738),n=a(1466),i=a(6943);let r=0===(0,s.C6)().length?(0,s.ZF)({apiKey:"AIzaSyDL2GylAt2YVRSstEpp4hucbcqw7RuVk4o",authDomain:"internship-matching-app.firebaseapp.com",projectId:"internship-matching-app",messagingSenderId:"299078518812",appId:"1:299078518812:web:03ad34bb4323c497a677d9"}):(0,s.C6)()[0],d=(0,n.v0)(r),l=(0,i.ad)(r),o=new n.hJ},3448:function(e,t,a){"use strict";a.d(t,{cn:function(){return i}});var s=a(1994),n=a(3335);function i(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,n.m6)((0,s.W)(t))}},3880:function(e,t,a){"use strict";a.d(t,{d:function(){return d}});var s=a(6410),n=a(6943),i=a(1437);class r{async getStats(){try{let e=(0,n.hJ)(s.db,"users"),t=(0,n.hJ)(s.db,"companies"),a=(0,n.hJ)(s.db,"jobPostings"),i=(0,n.hJ)(s.db,"applications"),r=(0,n.hJ)(s.db,"matches"),d=await (0,n.Yp)((0,n.IO)(e,(0,n.ar)("role","==","student"))),l=await (0,n.Yp)(t),o=await (0,n.Yp)((0,n.IO)(a,(0,n.ar)("status","==","pending_approval"))),c=await (0,n.Yp)((0,n.IO)(a,(0,n.ar)("status","==","published"))),u=await (0,n.Yp)((0,n.IO)(i,(0,n.ar)("status","==","pending_admin"))),p=await (0,n.Yp)(r),m=await (0,n.Yp)((0,n.IO)(t,(0,n.ar)("isApproved","==",!1)));return{totalUsers:d.data().count,totalCompanies:l.data().count,pendingCompanies:m.data().count,pendingJobs:o.data().count,activeJobs:c.data().count,pendingApplications:u.data().count,totalMatches:p.data().count}}catch(e){throw console.error("AdminService.getStats error:",e),e}}async getPendingJobs(){try{let e=(0,n.IO)((0,n.hJ)(s.db,"jobPostings"),(0,n.ar)("status","==","pending_approval"),(0,n.Xo)("createdAt","asc"));return(await (0,n.PL)(e)).docs.map(e=>({id:e.id,...e.data()}))}catch(t){var e;if("failed-precondition"===t.code||(null===(e=t.message)||void 0===e?void 0:e.includes("index"))){console.warn("Composite index missing for getPendingJobs, falling back to unordered query. Create the index in Firebase Console.");let e=(0,n.IO)((0,n.hJ)(s.db,"jobPostings"),(0,n.ar)("status","==","pending_approval"));return(await (0,n.PL)(e)).docs.map(e=>({id:e.id,...e.data()})).sort((e,t)=>{var a,s,n,i,r,d;return(null!==(r=null===(s=e.createdAt)||void 0===s?void 0:null===(a=s.toMillis)||void 0===a?void 0:a.call(s))&&void 0!==r?r:0)-(null!==(d=null===(i=t.createdAt)||void 0===i?void 0:null===(n=i.toMillis)||void 0===n?void 0:n.call(i))&&void 0!==d?d:0)})}throw t}}async getAllJobs(){let e=(0,n.IO)((0,n.hJ)(s.db,"jobPostings"),(0,n.Xo)("createdAt","desc"));return(await (0,n.PL)(e)).docs.map(e=>({id:e.id,...e.data()}))}async approveJob(e){let t=(0,n.doc)(s.db,"jobPostings",e),a=await (0,n.getDoc)(t);if(!a.exists())return;let r=a.data();await (0,n.r7)(t,{status:"published",updatedAt:(0,n.Bt)()}),(null==r?void 0:r.companyId)&&await i.B.createNotification(r.companyId,"求人が承認されました","求人「".concat(r.title,"」が公開されました。"),"job_approved_admin","/company/jobs/".concat(e))}async rejectJob(e){let t=(0,n.doc)(s.db,"jobPostings",e),a=await (0,n.getDoc)(t),r=a.exists()?a.data():null;await (0,n.r7)(t,{status:"draft",updatedAt:(0,n.Bt)()}),(null==r?void 0:r.companyId)&&await i.B.createNotification(r.companyId,"求人が差し戻されました","求人「".concat(r.title,"」の内容を確認してください。"),"system","/company/jobs/".concat(e))}async getAllCompanies(){return(await (0,n.PL)((0,n.hJ)(s.db,"companies"))).docs.map(e=>({userId:e.id,...e.data()}))}async approveCompany(e){await (0,n.r7)((0,n.doc)(s.db,"companies",e),{isApproved:!0,updatedAt:(0,n.Bt)()}),await i.B.createNotification(e,"企業アカウントが承認されました","アカウント審査が完了しました。求人の作成が可能です。","system","/company/dashboard")}async revokeCompany(e){await (0,n.r7)((0,n.doc)(s.db,"companies",e),{isApproved:!1,updatedAt:(0,n.Bt)()})}async getPendingApplications(){try{let e=(0,n.IO)((0,n.hJ)(s.db,"applications"),(0,n.ar)("status","==","pending_admin"),(0,n.Xo)("createdAt","asc"));return(await (0,n.PL)(e)).docs.map(e=>({id:e.id,...e.data()}))}catch(t){var e;if("failed-precondition"===t.code||(null===(e=t.message)||void 0===e?void 0:e.includes("index"))){console.warn("Composite index missing for getPendingApplications, falling back.");let e=(0,n.IO)((0,n.hJ)(s.db,"applications"),(0,n.ar)("status","==","pending_admin"));return(await (0,n.PL)(e)).docs.map(e=>({id:e.id,...e.data()})).sort((e,t)=>{var a,s,n,i,r,d;return(null!==(r=null===(s=e.createdAt)||void 0===s?void 0:null===(a=s.toMillis)||void 0===a?void 0:a.call(s))&&void 0!==r?r:0)-(null!==(d=null===(i=t.createdAt)||void 0===i?void 0:null===(n=i.toMillis)||void 0===n?void 0:n.call(i))&&void 0!==d?d:0)})}throw t}}async getApplicationDetails(e){let t=await (0,n.getDoc)((0,n.doc)(s.db,"jobPostings",e.jobId)),a=await (0,n.getDoc)((0,n.doc)(s.db,"students",e.studentId)),i=await (0,n.getDoc)((0,n.doc)(s.db,"companies",e.companyId));return{job:t.exists()?t.data():null,student:a.exists()?a.data():null,company:i.exists()?i.data():null}}async approveApplication(e){}async getAllMatches(){try{let e=(0,n.IO)((0,n.hJ)(s.db,"matches"),(0,n.Xo)("createdAt","desc")),t=(await (0,n.PL)(e)).docs.map(e=>({id:e.id,...e.data()}));return await Promise.all(t.map(async e=>{let t=await (0,n.getDoc)((0,n.doc)(s.db,"students",e.studentId)),a=await (0,n.getDoc)((0,n.doc)(s.db,"companies",e.companyId)),i=await (0,n.getDoc)((0,n.doc)(s.db,"jobPostings",e.jobId));return{...e,studentName:t.exists()?t.data().name:"退会済みユーザー",companyName:a.exists()?a.data().name:"不明な企業",jobTitle:i.exists()?i.data().title:"削除された求人"}}))}catch(e){throw console.error("getAllMatches error:",e),e}}async getMatchEvaluations(e){try{let t=(0,n.IO)((0,n.hJ)(s.db,"evaluations"),(0,n.ar)("matchId","==",e));return(await (0,n.PL)(t)).docs.map(e=>({id:e.id,...e.data()}))}catch(e){return console.error(e),[]}}}let d=new r},1437:function(e,t,a){"use strict";a.d(t,{B:function(){return d},z:function(){return l}});var s=a(6410),n=a(6943),i=a(2265);class r{async markAsRead(e){let t=(0,n.doc)(s.db,"notifications",e);await (0,n.r7)(t,{read:!0,updatedAt:(0,n.Bt)()})}async markAllAsRead(e){let t=(0,n.IO)((0,n.hJ)(s.db,"notifications"),(0,n.ar)("userId","==",e),(0,n.ar)("read","==",!1)),a=await (0,n.PL)(t);if(a.empty)return;let i=(0,n.qs)(s.db);a.docs.forEach(e=>{i.update(e.ref,{read:!0,updatedAt:(0,n.Bt)()})}),await i.commit()}async createNotification(e,t,a,i,r){try{await (0,n.ET)((0,n.hJ)(s.db,"notifications"),{userId:e,title:t,message:a,type:i,link:r,read:!1,createdAt:(0,n.Bt)()})}catch(e){console.error("Error creating notification:",e)}}}let d=new r;function l(e,t){let[a,r]=(0,i.useState)([]),[d,l]=(0,i.useState)(0),[o,c]=(0,i.useState)(!0);return(0,i.useEffect)(()=>{let a;if(!e){r([]),l(0),c(!1);return}a="admin"===t?(0,n.IO)((0,n.hJ)(s.db,"notifications"),(0,n.ar)("userId","in",[e,"admin"]),(0,n.Xo)("createdAt","desc"),(0,n.b9)(20)):(0,n.IO)((0,n.hJ)(s.db,"notifications"),(0,n.ar)("userId","==",e),(0,n.Xo)("createdAt","desc"),(0,n.b9)(20));let i=(0,n.cf)(a,e=>{let t=e.docs.map(e=>({id:e.id,...e.data()}));r(t),l(t.filter(e=>!e.read).length),c(!1)},e=>{console.error("Notification listener error:",e),c(!1)});return()=>i()},[e,t]),{notifications:a,unreadCount:d,loading:o}}}},function(e){e.O(0,[287,8483,1442,8697,2971,2117,1744],function(){return e(e.s=4441)}),_N_E=e.O()}]);