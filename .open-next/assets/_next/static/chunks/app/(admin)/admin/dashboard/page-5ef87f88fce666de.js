(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9871],{5460:function(t,e,a){Promise.resolve().then(a.bind(a,7867))},5005:function(t,e,a){"use strict";a.d(e,{Z:function(){return n}});let n=(0,a(8755).Z)("briefcase",[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]])},44:function(t,e,a){"use strict";a.d(e,{Z:function(){return n}});let n=(0,a(8755).Z)("building",[["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M9 22v-3a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v3",key:"cabbwy"}],["rect",{x:"4",y:"2",width:"16",height:"20",rx:"2",key:"1uxh74"}]])},1671:function(t,e,a){"use strict";a.d(e,{Z:function(){return n}});let n=(0,a(8755).Z)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},8736:function(t,e,a){"use strict";a.d(e,{Z:function(){return n}});let n=(0,a(8755).Z)("file-text",[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]])},1817:function(t,e,a){"use strict";a.d(e,{Z:function(){return n}});let n=(0,a(8755).Z)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},3578:function(t,e,a){"use strict";a.d(e,{Z:function(){return n}});let n=(0,a(8755).Z)("shield-alert",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]])},5805:function(t,e,a){"use strict";a.d(e,{Z:function(){return n}});let n=(0,a(8755).Z)("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]])},7867:function(t,e,a){"use strict";a.r(e),a.d(e,{default:function(){return b}});var n=a(7437),i=a(2265),s=a(3880),d=a(757),r=a(1817),o=a(44),c=a(5805),l=a(1671),u=a(3578),p=a(5005),h=a(8736),m=a(7648);function b(){let[t,e]=(0,i.useState)(null),[a,b]=(0,i.useState)(!0);return((0,i.useEffect)(()=>{(async function(){try{let t=await s.d.getStats();e(t)}catch(t){console.error(t)}finally{b(!1)}})()},[]),a)?(0,n.jsx)("div",{className:"flex justify-center p-12",children:(0,n.jsx)(r.Z,{className:"animate-spin text-[#1E3A5F]"})}):(0,n.jsxs)("div",{className:"space-y-8",children:[(0,n.jsx)("h1",{className:"text-2xl font-bold text-[#1E3A5F]",children:"ダッシュボード"}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[(0,n.jsx)(f,{icon:(0,n.jsx)(o.Z,{}),label:"登録企業数",value:null==t?void 0:t.totalCompanies,link:"/admin/companies"}),(0,n.jsx)(f,{icon:(0,n.jsx)(c.Z,{}),label:"登録学生数",value:null==t?void 0:t.totalUsers,link:"/admin/users"}),(0,n.jsx)(f,{icon:(0,n.jsx)(l.Z,{}),label:"マッチング成立数",value:null==t?void 0:t.totalMatches,link:"/admin/matches"}),(0,n.jsx)(f,{icon:(0,n.jsx)(u.Z,{}),label:"企業承認待ち",value:null==t?void 0:t.pendingCompanies,highlight:!0,link:"/admin/companies"})]}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,n.jsxs)(d.Z,{className:"p-6",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,n.jsxs)("h3",{className:"font-bold flex items-center gap-2",children:[(0,n.jsx)(p.Z,{size:20,className:"text-[#1E3A5F]"}),"求人の状況"]}),(0,n.jsx)(m.default,{href:"/admin/jobs",className:"text-sm text-[#1E3A5F] hover:underline",children:"すべて見る"})]}),(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,n.jsx)(m.default,{href:"/admin/jobs",className:"block",children:(0,n.jsxs)("div",{className:"bg-amber-50 p-4 rounded-lg text-center hover:bg-amber-100 transition-colors cursor-pointer",children:[(0,n.jsx)("span",{className:"block text-2xl font-bold text-amber-700",children:null==t?void 0:t.pendingJobs}),(0,n.jsx)("span",{className:"text-xs text-amber-800 font-bold",children:"承認待ち"})]})}),(0,n.jsx)(m.default,{href:"/admin/jobs",className:"block",children:(0,n.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg text-center hover:bg-gray-100 transition-colors cursor-pointer",children:[(0,n.jsx)("span",{className:"block text-2xl font-bold text-gray-600",children:null==t?void 0:t.activeJobs}),(0,n.jsx)("span",{className:"text-xs text-gray-500",children:"公開中"})]})})]})]}),(0,n.jsxs)(d.Z,{className:"p-6",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,n.jsxs)("h3",{className:"font-bold flex items-center gap-2",children:[(0,n.jsx)(h.Z,{size:20,className:"text-[#1E3A5F]"}),"応募の状況"]}),(0,n.jsx)(m.default,{href:"/admin/applications",className:"text-sm text-[#1E3A5F] hover:underline",children:"すべて見る"})]}),(0,n.jsx)("div",{className:"grid grid-cols-2 gap-4",children:(0,n.jsx)(m.default,{href:"/admin/applications",className:"block",children:(0,n.jsxs)("div",{className:"bg-amber-50 p-4 rounded-lg text-center hover:bg-amber-100 transition-colors cursor-pointer",children:[(0,n.jsx)("span",{className:"block text-2xl font-bold text-amber-700",children:null==t?void 0:t.pendingApplications}),(0,n.jsx)("span",{className:"text-xs text-amber-800 font-bold",children:"管理者承認待ち"})]})})})]})]})]})}function f(t){let{icon:e,label:a,value:i,highlight:s,link:r}=t,o=(0,n.jsxs)(d.Z,{className:"p-6 flex items-center gap-4 ".concat(s&&i>0?"border-amber-300 bg-amber-50/50":""," ").concat(r?"hover:shadow-md transition-shadow cursor-pointer":""),children:[(0,n.jsx)("div",{className:"p-3 rounded-lg bg-[#1E3A5F]/10 text-[#1E3A5F]",children:e}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-sm text-gray-500",children:a}),(0,n.jsx)("p",{className:"text-2xl font-bold ".concat(s&&i>0?"text-amber-700":""),children:i})]})]});return r?(0,n.jsx)(m.default,{href:r,children:o}):o}},757:function(t,e,a){"use strict";a.d(e,{Z:function(){return d}});var n=a(7437),i=a(2265),s=a(3448);let d=(0,i.forwardRef)((t,e)=>{let{className:a,...i}=t;return(0,n.jsx)("div",{ref:e,className:(0,s.cn)("glass rounded-2xl p-6 transition-all duration-300",a),...i})});d.displayName="Card"},6410:function(t,e,a){"use strict";a.d(e,{I:function(){return r},V:function(){return c},db:function(){return o}});var n=a(738),i=a(1466),s=a(6943);let d=0===(0,n.C6)().length?(0,n.ZF)({apiKey:"AIzaSyDL2GylAt2YVRSstEpp4hucbcqw7RuVk4o",authDomain:"internship-matching-app.firebaseapp.com",projectId:"internship-matching-app",messagingSenderId:"299078518812",appId:"1:299078518812:web:03ad34bb4323c497a677d9"}):(0,n.C6)()[0],r=(0,i.v0)(d),o=(0,s.ad)(d),c=new i.hJ},3448:function(t,e,a){"use strict";a.d(e,{cn:function(){return s}});var n=a(1994),i=a(3335);function s(){for(var t=arguments.length,e=Array(t),a=0;a<t;a++)e[a]=arguments[a];return(0,i.m6)((0,n.W)(e))}},3880:function(t,e,a){"use strict";a.d(e,{d:function(){return r}});var n=a(6410),i=a(6943),s=a(1437);class d{async getStats(){try{let t=(0,i.hJ)(n.db,"users"),e=(0,i.hJ)(n.db,"companies"),a=(0,i.hJ)(n.db,"jobPostings"),s=(0,i.hJ)(n.db,"applications"),d=(0,i.hJ)(n.db,"matches"),r=await (0,i.Yp)((0,i.IO)(t,(0,i.ar)("role","==","student"))),o=await (0,i.Yp)(e),c=await (0,i.Yp)((0,i.IO)(a,(0,i.ar)("status","==","pending_approval"))),l=await (0,i.Yp)((0,i.IO)(a,(0,i.ar)("status","==","published"))),u=await (0,i.Yp)((0,i.IO)(s,(0,i.ar)("status","==","pending_admin"))),p=await (0,i.Yp)(d),h=await (0,i.Yp)((0,i.IO)(e,(0,i.ar)("isApproved","==",!1)));return{totalUsers:r.data().count,totalCompanies:o.data().count,pendingCompanies:h.data().count,pendingJobs:c.data().count,activeJobs:l.data().count,pendingApplications:u.data().count,totalMatches:p.data().count}}catch(t){throw console.error("AdminService.getStats error:",t),t}}async getPendingJobs(){try{let t=(0,i.IO)((0,i.hJ)(n.db,"jobPostings"),(0,i.ar)("status","==","pending_approval"),(0,i.Xo)("createdAt","asc"));return(await (0,i.PL)(t)).docs.map(t=>({id:t.id,...t.data()}))}catch(e){var t;if("failed-precondition"===e.code||(null===(t=e.message)||void 0===t?void 0:t.includes("index"))){console.warn("Composite index missing for getPendingJobs, falling back to unordered query. Create the index in Firebase Console.");let t=(0,i.IO)((0,i.hJ)(n.db,"jobPostings"),(0,i.ar)("status","==","pending_approval"));return(await (0,i.PL)(t)).docs.map(t=>({id:t.id,...t.data()})).sort((t,e)=>{var a,n,i,s,d,r;return(null!==(d=null===(n=t.createdAt)||void 0===n?void 0:null===(a=n.toMillis)||void 0===a?void 0:a.call(n))&&void 0!==d?d:0)-(null!==(r=null===(s=e.createdAt)||void 0===s?void 0:null===(i=s.toMillis)||void 0===i?void 0:i.call(s))&&void 0!==r?r:0)})}throw e}}async getAllJobs(){let t=(0,i.IO)((0,i.hJ)(n.db,"jobPostings"),(0,i.Xo)("createdAt","desc"));return(await (0,i.PL)(t)).docs.map(t=>({id:t.id,...t.data()}))}async approveJob(t){let e=(0,i.doc)(n.db,"jobPostings",t),a=await (0,i.getDoc)(e);if(!a.exists())return;let d=a.data();await (0,i.r7)(e,{status:"published",updatedAt:(0,i.Bt)()}),(null==d?void 0:d.companyId)&&await s.B.createNotification(d.companyId,"求人が承認されました","求人「".concat(d.title,"」が公開されました。"),"job_approved_admin","/company/jobs/".concat(t))}async rejectJob(t){let e=(0,i.doc)(n.db,"jobPostings",t),a=await (0,i.getDoc)(e),d=a.exists()?a.data():null;await (0,i.r7)(e,{status:"draft",updatedAt:(0,i.Bt)()}),(null==d?void 0:d.companyId)&&await s.B.createNotification(d.companyId,"求人が差し戻されました","求人「".concat(d.title,"」の内容を確認してください。"),"system","/company/jobs/".concat(t))}async getAllCompanies(){return(await (0,i.PL)((0,i.hJ)(n.db,"companies"))).docs.map(t=>({userId:t.id,...t.data()}))}async approveCompany(t){await (0,i.r7)((0,i.doc)(n.db,"companies",t),{isApproved:!0,updatedAt:(0,i.Bt)()}),await s.B.createNotification(t,"企業アカウントが承認されました","アカウント審査が完了しました。求人の作成が可能です。","system","/company/dashboard")}async revokeCompany(t){await (0,i.r7)((0,i.doc)(n.db,"companies",t),{isApproved:!1,updatedAt:(0,i.Bt)()})}async getPendingApplications(){try{let t=(0,i.IO)((0,i.hJ)(n.db,"applications"),(0,i.ar)("status","==","pending_admin"),(0,i.Xo)("createdAt","asc"));return(await (0,i.PL)(t)).docs.map(t=>({id:t.id,...t.data()}))}catch(e){var t;if("failed-precondition"===e.code||(null===(t=e.message)||void 0===t?void 0:t.includes("index"))){console.warn("Composite index missing for getPendingApplications, falling back.");let t=(0,i.IO)((0,i.hJ)(n.db,"applications"),(0,i.ar)("status","==","pending_admin"));return(await (0,i.PL)(t)).docs.map(t=>({id:t.id,...t.data()})).sort((t,e)=>{var a,n,i,s,d,r;return(null!==(d=null===(n=t.createdAt)||void 0===n?void 0:null===(a=n.toMillis)||void 0===a?void 0:a.call(n))&&void 0!==d?d:0)-(null!==(r=null===(s=e.createdAt)||void 0===s?void 0:null===(i=s.toMillis)||void 0===i?void 0:i.call(s))&&void 0!==r?r:0)})}throw e}}async getApplicationDetails(t){let e=await (0,i.getDoc)((0,i.doc)(n.db,"jobPostings",t.jobId)),a=await (0,i.getDoc)((0,i.doc)(n.db,"students",t.studentId)),s=await (0,i.getDoc)((0,i.doc)(n.db,"companies",t.companyId));return{job:e.exists()?e.data():null,student:a.exists()?a.data():null,company:s.exists()?s.data():null}}async approveApplication(t){}async getAllMatches(){try{let t=(0,i.IO)((0,i.hJ)(n.db,"matches"),(0,i.Xo)("createdAt","desc")),e=(await (0,i.PL)(t)).docs.map(t=>({id:t.id,...t.data()}));return await Promise.all(e.map(async t=>{let e=await (0,i.getDoc)((0,i.doc)(n.db,"students",t.studentId)),a=await (0,i.getDoc)((0,i.doc)(n.db,"companies",t.companyId)),s=await (0,i.getDoc)((0,i.doc)(n.db,"jobPostings",t.jobId));return{...t,studentName:e.exists()?e.data().name:"退会済みユーザー",companyName:a.exists()?a.data().name:"不明な企業",jobTitle:s.exists()?s.data().title:"削除された求人"}}))}catch(t){throw console.error("getAllMatches error:",t),t}}async getMatchEvaluations(t){try{let e=(0,i.IO)((0,i.hJ)(n.db,"evaluations"),(0,i.ar)("matchId","==",t));return(await (0,i.PL)(e)).docs.map(t=>({id:t.id,...t.data()}))}catch(t){return console.error(t),[]}}}let r=new d},1437:function(t,e,a){"use strict";a.d(e,{B:function(){return r},z:function(){return o}});var n=a(6410),i=a(6943),s=a(2265);class d{async markAsRead(t){let e=(0,i.doc)(n.db,"notifications",t);await (0,i.r7)(e,{read:!0,updatedAt:(0,i.Bt)()})}async markAllAsRead(t){let e=(0,i.IO)((0,i.hJ)(n.db,"notifications"),(0,i.ar)("userId","==",t),(0,i.ar)("read","==",!1)),a=await (0,i.PL)(e);if(a.empty)return;let s=(0,i.qs)(n.db);a.docs.forEach(t=>{s.update(t.ref,{read:!0,updatedAt:(0,i.Bt)()})}),await s.commit()}async createNotification(t,e,a,s,d){try{await (0,i.ET)((0,i.hJ)(n.db,"notifications"),{userId:t,title:e,message:a,type:s,link:d,read:!1,createdAt:(0,i.Bt)()})}catch(t){console.error("Error creating notification:",t)}}}let r=new d;function o(t,e){let[a,d]=(0,s.useState)([]),[r,o]=(0,s.useState)(0),[c,l]=(0,s.useState)(!0);return(0,s.useEffect)(()=>{let a;if(!t){d([]),o(0),l(!1);return}a="admin"===e?(0,i.IO)((0,i.hJ)(n.db,"notifications"),(0,i.ar)("userId","in",[t,"admin"]),(0,i.Xo)("createdAt","desc"),(0,i.b9)(20)):(0,i.IO)((0,i.hJ)(n.db,"notifications"),(0,i.ar)("userId","==",t),(0,i.Xo)("createdAt","desc"),(0,i.b9)(20));let s=(0,i.cf)(a,t=>{let e=t.docs.map(t=>({id:t.id,...t.data()}));d(e),o(e.filter(t=>!t.read).length),l(!1)},t=>{console.error("Notification listener error:",t),l(!1)});return()=>s()},[t,e]),{notifications:a,unreadCount:r,loading:c}}}},function(t){t.O(0,[287,8483,1442,8697,7648,2971,2117,1744],function(){return t(t.s=5460)}),_N_E=t.O()}]);