(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8701],{4746:function(e,t,s){Promise.resolve().then(s.bind(s,4399))},4399:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return g}});var a=s(7437),i=s(2265),l=s(4362),n=s(4279),c=s(6943),r=s(6410),d=s(757),x=s(6334),o=s(8711),m=s(1817),h=s(1671),u=s(1047),p=s(3417),j=s(6424),y=s(6256);function g(e){let{params:t}=e,{matchId:s}=t,{user:g}=(0,l.a)(),[f,N]=(0,i.useState)(null),[v,b]=(0,i.useState)(null),[w,E]=(0,i.useState)([]),[C,S]=(0,i.useState)(!0),[k,z]=(0,i.useState)(null),[M,D]=(0,i.useState)(0),[F,I]=(0,i.useState)(""),[Z,_]=(0,i.useState)(!1),[A,U]=(0,i.useState)(null),[B,R]=(0,i.useState)(""),[W,O]=(0,i.useState)(!1);(0,i.useEffect)(()=>{!async function(){if(g)try{let e=await n.i.getMatch(s);if(!e||e.companyId!==g.id)throw Error("Match not found or unauthorized");N(e);let t=await (0,c.getDoc)((0,c.doc)(r.db,"students",e.studentId));t.exists()?b(t.data()):b({name:"Unknown",userId:e.studentId});let a=await n.i.getReports(s);if(E(a),"completed"===e.status){let e=await n.i.getEvaluation(s,g.id);z(e)}}catch(e){console.error("Error fetching data:",e)}finally{S(!1)}}()},[s,g]);let G=async()=>{if(f&&confirm("このインターンシップを終了しますか？\n終了すると、学生への評価が可能になります。"))try{await n.i.completeInternship(f.id);let e=await n.i.getMatch(f.id);N(e)}catch(e){console.error(e),alert("ステータス更新に失敗しました")}},L=async e=>{if(B){O(!0);try{if(await n.i.addCompanyComment(e,B),f){let e=await n.i.getReports(f.id);E(e)}U(null),R("")}catch(e){console.error(e),alert("コメントの送信に失敗しました")}finally{O(!1)}}};return C?(0,a.jsx)("div",{className:"flex justify-center p-12",children:(0,a.jsx)(m.Z,{className:"animate-spin"})}):f?(0,a.jsxs)("div",{className:"max-w-4xl mx-auto space-y-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center bg-[#1E3A5F] text-white p-6 rounded-xl shadow-lg",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,a.jsx)("h1",{className:"text-xl font-bold",children:null==v?void 0:v.name}),(0,a.jsx)("span",{className:"text-xs bg-white/20 px-2 py-0.5 rounded",children:null==v?void 0:v.university})]}),(0,a.jsxs)("p",{className:"text-sm opacity-90",children:["期間: ",f.startDate?(0,j.WU)(f.startDate.toDate(),"yyyy/MM/dd"):"-",f.endDate?" ~ ".concat((0,j.WU)(f.endDate.toDate(),"yyyy/MM/dd")):" ~ 進行中"]})]}),(0,a.jsx)("div",{children:"active"===f.status?(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)(o.C,{variant:"success",className:"bg-[#48BB78] text-white border-none",children:"進行中"}),(0,a.jsxs)(x.z,{size:"sm",className:"bg-white text-[#1E3A5F] hover:bg-white/90",onClick:G,children:[(0,a.jsx)(h.Z,{size:16,className:"mr-1"}),"インターンを終了する"]})]}):(0,a.jsx)(o.C,{variant:"outline",className:"text-white border-white",children:"完了"})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,a.jsxs)("div",{className:"md:col-span-2 space-y-6",children:[(0,a.jsx)("div",{className:"flex justify-between items-center",children:(0,a.jsx)("h2",{className:"text-lg font-bold text-[#1E3A5F]",children:"日報一覧"})}),0===w.length?(0,a.jsx)(d.Z,{className:"p-8 text-center text-gray-500",children:"まだ日報が提出されていません。"}):(0,a.jsx)("div",{className:"space-y-4",children:w.map(e=>(0,a.jsxs)(d.Z,{className:"p-5",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-3 border-b pb-2",children:[(0,a.jsx)(u.Z,{size:16,className:"text-gray-400"}),(0,a.jsx)("span",{className:"font-bold text-[#1E3A5F]",children:(0,j.WU)(e.date.toDate(),"yyyy/MM/dd")})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-xs text-gray-400 block",children:"業務内容"}),(0,a.jsx)("p",{className:"text-sm text-gray-800 whitespace-pre-wrap",children:e.content})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-xs text-gray-400 block",children:"学んだこと"}),(0,a.jsx)("p",{className:"text-sm text-gray-800 whitespace-pre-wrap",children:e.learning})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-xs text-gray-400 block",children:"明日の目標"}),(0,a.jsx)("p",{className:"text-sm text-gray-800 whitespace-pre-wrap",children:e.nextGoals})]}),(0,a.jsx)("div",{className:"bg-gray-50 p-3 rounded-lg mt-2 border border-gray-100",children:e.companyComment?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex items-center gap-1 text-blue-800 font-bold mb-1 text-xs",children:[(0,a.jsx)(p.Z,{size:12}),"フィードバック済み"]}),(0,a.jsx)("p",{className:"text-sm text-blue-900",children:e.companyComment})]}):A===e.id?(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("textarea",{className:"w-full text-sm border rounded p-2",value:B,onChange:e=>R(e.target.value),placeholder:"フィードバックを入力..."}),(0,a.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,a.jsx)(x.z,{size:"sm",variant:"secondary",onClick:()=>U(null),children:"キャンセル"}),(0,a.jsx)(x.z,{size:"sm",onClick:()=>L(e.id),isLoading:W,children:"送信"})]})]}):(0,a.jsx)(x.z,{size:"sm",variant:"outline",className:"w-full text-xs text-gray-500 hover:text-[#1E3A5F]",onClick:()=>{U(e.id),R("")},children:"+ フィードバックを書く"})})]})]},e.id))})]}),(0,a.jsx)("div",{className:"space-y-6",children:"completed"===f.status&&(0,a.jsx)(y.B,{evaluation:k,onSubmit:async(e,t)=>{if(g&&f&&v&&confirm("評価を送信しますか？送信後は変更できません。")){_(!0);try{await n.i.submitEvaluation(f.id,g.id,v.userId,e,t);let s=await n.i.getEvaluation(f.id,g.id);z(s)}catch(e){console.error(e),alert("評価の送信に失敗しました")}finally{_(!1)}}},isSubmitting:Z,userRole:"company",targetName:(null==v?void 0:v.name)||"学生"})})]})]}):(0,a.jsx)("div",{className:"p-12 text-center",children:"データが見つかりません"})}}},function(e){e.O(0,[287,8483,1442,8697,6165,1208,2971,2117,1744],function(){return e(e.s=4746)}),_N_E=e.O()}]);