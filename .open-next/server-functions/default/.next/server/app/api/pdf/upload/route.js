"use strict";(()=>{var e={};e.id=588,e.ids=[588],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},77822:(e,r,o)=>{o.r(r),o.d(r,{originalPathname:()=>P,patchFetch:()=>g,requestAsyncStorage:()=>c,routeModule:()=>u,serverHooks:()=>A,staticGenerationAsyncStorage:()=>f});var t={};o.r(t),o.d(t,{POST:()=>d});var s=o(73278),a=o(45002),n=o(54877),i=o(71309);let l=process.env.GAS_API_URL||"",p=process.env.GAS_API_KEY||"";async function d(e){try{let r;if(!l||"YOUR_GAS_WEB_APP_URL"===l)return console.error("GAS_API_URL is not configured"),i.NextResponse.json({error:"Server configuration error: GAS API URL not set"},{status:500});if(!p||"YOUR_SECRET_API_KEY"===p)return console.error("GAS_API_KEY is not configured"),i.NextResponse.json({error:"Server configuration error: GAS API Key not set"},{status:500});let o=(await e.formData()).get("file");if(!o)return i.NextResponse.json({error:"No file provided"},{status:400});if(o.size>10485760)return i.NextResponse.json({error:"File too large (max 10MB)"},{status:400});let t=await o.arrayBuffer(),s=new Uint8Array(t),a="";for(let e=0;e<s.byteLength;e++)a+=String.fromCharCode(s[e]);let n=btoa(a);console.log(`[PDF Upload] GAS_API_URL configured: ${!!l}`),console.log(`[PDF Upload] GAS_API_KEY configured: ${!!p}`),p?console.log(`[PDF Upload] GAS_API_KEY (first 3 chars): ${p.substring(0,3)}***`):console.error("[PDF Upload] GAS_API_KEY is missing or empty!");let d={apiKey:p,fileName:o.name,mimeType:o.type,fileData:n};console.log(`[PDF Upload] Payload prepared. apiKey included: ${!!d.apiKey}`),d.apiKey&&console.log(`[PDF Upload] Payload apiKey matches env var: ${d.apiKey===p}`),console.log(`[PDF Upload] Sending to GAS URL: ${l}`);let u=await fetch(l,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(d),redirect:"manual"});if(console.log(`[PDF Upload] Initial GAS Response status: ${u.status}`),302===u.status){let e=u.headers.get("location");console.log(`[PDF Upload] Redirect Location: ${e}`),e&&(u=await fetch(e),console.log(`[PDF Upload] Followed Response status: ${u.status}`))}else if(401===u.status||403===u.status)return console.error('[PDF Upload] GAS Auth Error. Check deployment ("Anyone" access required).'),i.NextResponse.json({error:"GASへのアクセス権限がありません。デプロイ設定で「アクセスできるユーザー：全員」になっているか、URLが正しいか確認してください（組織ドメインが含まれていると外部からアクセスできない場合があります）。"},{status:500});let c=await u.text();if(console.log(`[PDF Upload] GAS Response body (first 200 chars): ${c.substring(0,200)}`),c.trim().toLowerCase().startsWith("<!doctype")||c.trim().toLowerCase().startsWith("<html"))return console.error("[PDF Upload] GAS returned HTML instead of JSON."),i.NextResponse.json({error:"GAS APIがHTML（ログイン画面など）を返しました。デプロイ設定（アクセス権限）またはURLを確認してください。"},{status:500});try{r=JSON.parse(c)}catch(e){return console.error("[PDF Upload] Failed to parse GAS response as JSON:",c.substring(0,200)),i.NextResponse.json({error:"GAS APIのレスポンスをパースできませんでした"},{status:500})}if(r.error)return console.error("[PDF Upload] GAS returned error:",r.error),i.NextResponse.json({error:r.error},{status:500});if(!r.fileId)return console.error("[PDF Upload] GAS response missing fileId:",r),i.NextResponse.json({error:"GAS APIからfileIdが返されませんでした"},{status:500});return console.log(`[PDF Upload] Success: fileId=${r.fileId}`),i.NextResponse.json(r)}catch(e){return console.error("[PDF Upload] Error:",e),i.NextResponse.json({error:`PDFアップロードエラー: ${e.message}`},{status:500})}}let u=new s.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/pdf/upload/route",pathname:"/api/pdf/upload",filename:"route",bundlePath:"app/api/pdf/upload/route"},resolvedPagePath:"/Users/kazuma/Documents/dev/intern/internship-matching/src/app/api/pdf/upload/route.ts",nextConfigOutput:"standalone",userland:t}),{requestAsyncStorage:c,staticGenerationAsyncStorage:f,serverHooks:A}=u,P="/api/pdf/upload/route";function g(){return(0,n.patchFetch)({serverHooks:A,staticGenerationAsyncStorage:f})}}};var r=require("../../../../webpack-runtime.js");r.C(e);var o=e=>r(r.s=e),t=r.X(0,[379,833],()=>o(77822));module.exports=t})();