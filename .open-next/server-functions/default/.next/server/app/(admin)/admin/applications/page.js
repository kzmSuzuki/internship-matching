(()=>{var e={};e.id=539,e.ids=[539],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},84770:e=>{"use strict";e.exports=require("crypto")},80665:e=>{"use strict";e.exports=require("dns")},17702:e=>{"use strict";e.exports=require("events")},92048:e=>{"use strict";e.exports=require("fs")},32615:e=>{"use strict";e.exports=require("http")},32694:e=>{"use strict";e.exports=require("http2")},98216:e=>{"use strict";e.exports=require("net")},19801:e=>{"use strict";e.exports=require("os")},55315:e=>{"use strict";e.exports=require("path")},35816:e=>{"use strict";e.exports=require("process")},76162:e=>{"use strict";e.exports=require("stream")},82452:e=>{"use strict";e.exports=require("tls")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},95223:(e,t,a)=>{"use strict";a.r(t),a.d(t,{GlobalError:()=>n.a,__next_app__:()=>u,originalPathname:()=>p,pages:()=>o,routeModule:()=>m,tree:()=>c}),a(665),a(5519),a(90996),a(15539);var s=a(30170),i=a(45002),r=a(83876),n=a.n(r),d=a(66299),l={};for(let e in d)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>d[e]);a.d(t,l);let c=["",{children:["(admin)",{children:["admin",{children:["applications",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(a.bind(a,665)),"/Users/kazuma/Documents/dev/intern/internship-matching/src/app/(admin)/admin/applications/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(a.bind(a,5519)),"/Users/kazuma/Documents/dev/intern/internship-matching/src/app/(admin)/admin/layout.tsx"]}]},{"not-found":[()=>Promise.resolve().then(a.t.bind(a,90996,23)),"next/dist/client/components/not-found-error"],metadata:{icon:[async e=>(await Promise.resolve().then(a.bind(a,73881))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(a.bind(a,15539)),"/Users/kazuma/Documents/dev/intern/internship-matching/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(a.t.bind(a,90996,23)),"next/dist/client/components/not-found-error"],metadata:{icon:[async e=>(await Promise.resolve().then(a.bind(a,73881))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}],o=["/Users/kazuma/Documents/dev/intern/internship-matching/src/app/(admin)/admin/applications/page.tsx"],p="/(admin)/admin/applications/page",u={require:a,loadChunk:()=>Promise.resolve()},m=new s.AppPageRouteModule({definition:{kind:i.x.APP_PAGE,page:"/(admin)/admin/applications/page",pathname:"/admin/applications",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},58992:(e,t,a)=>{Promise.resolve().then(a.bind(a,38304))},50820:(e,t,a)=>{"use strict";a.d(t,{Z:()=>s});let s=(0,a(9148).Z)("calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]])},38304:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>x});var s=a(97247),i=a(28964),r=a(57793),n=a(68170),d=a(17596),l=a(55039),c=a(76219),o=a(8749),p=a(50820),u=a(96369),m=a(4193);function x(){let[e,t]=(0,i.useState)([]),[a,x]=(0,i.useState)(!0),[h,y]=(0,i.useState)(null),[g,f]=(0,i.useState)(null),[b,v]=(0,i.useState)(""),j=e.filter(e=>{if(!b)return!0;let t=b.toLowerCase(),a=e.studentName?.toLowerCase()||"",s=e.companyName?.toLowerCase()||"";return a.includes(t)||s.includes(t)}),w=async e=>{try{let t=await r.d.getApplicationDetails(e);y({...e,...t})}catch(e){console.error(e),alert("詳細の取得に失敗しました")}},N=async e=>{if(confirm("この応募を承認して、企業側へ通知しますか？")){f(e);try{await n.v.approveByAdmin(e),t(t=>t.filter(t=>t.id!==e)),y(null)}catch(e){console.error(e),alert("承認に失敗しました")}finally{f(null)}}};return a?s.jsx("div",{className:"flex justify-center p-12",children:s.jsx(o.Z,{className:"animate-spin"})}):(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[(0,s.jsxs)("div",{children:[s.jsx("h1",{className:"text-2xl font-bold text-[#1E3A5F]",children:"応募承認"}),(0,s.jsxs)("p",{className:"text-gray-500",children:["管理者確認待ちの応募が ",j.length," 件あります"]})]}),s.jsx("input",{type:"text",placeholder:"学生名・企業名で検索...",className:"border border-gray-300 rounded-lg px-4 py-2 text-sm w-full md:w-64 focus:outline-none focus:ring-2 focus:ring-[#1E3A5F]",value:b,onChange:e=>v(e.target.value)})]}),0===j.length?s.jsx(d.Z,{className:"p-12 text-center text-gray-500",children:"該当する応募はありません。"}):s.jsx("div",{className:"grid gap-4",children:j.map(e=>s.jsx(d.Z,{className:"p-6",children:(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx(c.C,{variant:"warning",children:"管理者承認待ち"}),(0,s.jsxs)("span",{className:"text-xs text-gray-500",children:["ID: ",e.id]})]}),s.jsx("h3",{className:"font-bold text-[#1E3A5F] mb-1",children:e.jobTitle}),(0,s.jsxs)("div",{className:"text-sm text-gray-600 mb-2",children:[(0,s.jsxs)("span",{children:["学生: ",e.studentName]})," / ",(0,s.jsxs)("span",{children:["企業: ",e.companyName]})]}),s.jsx("div",{className:"flex items-center gap-4 text-sm text-gray-600 mb-2",children:(0,s.jsxs)("span",{className:"flex items-center gap-1",children:[s.jsx(p.Z,{size:14})," Applied: ",(0,u.WU)(e.createdAt.toDate(),"yyyy/MM/dd HH:mm")]})}),(0,s.jsxs)("p",{className:"text-sm font-bold truncate",children:["Message: ",e.message.substring(0,50),"..."]})]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[s.jsx(l.z,{variant:"outline",onClick:()=>w(e),children:"詳細"}),s.jsx(l.z,{className:"bg-[#1E3A5F] hover:bg-[#16304F]",isLoading:g===e.id,onClick:()=>N(e.id),children:"承認"})]})]})},e.id))}),s.jsx(m.u,{isOpen:!!h,onClose:()=>y(null),title:"応募詳細",children:h&&(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{children:[s.jsx("h2",{className:"font-bold text-lg mb-4",children:"応募情報"}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,s.jsxs)("div",{children:[s.jsx("label",{className:"text-xs text-gray-400 block",children:"学生"}),s.jsx("p",{className:"font-bold",children:h.student?.name||h.studentId}),s.jsx("p",{className:"text-xs",children:h.student?.university})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{className:"text-xs text-gray-400 block",children:"企業 / 求人"}),s.jsx("p",{className:"font-bold",children:h.company?.name||h.companyId}),s.jsx("p",{className:"text-xs",children:h.job?.title||h.jobId})]})]})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{className:"text-xs text-gray-400 block mb-1",children:"メッセージ"}),s.jsx("div",{className:"bg-gray-50 p-3 rounded text-sm whitespace-pre-wrap",children:h.message})]}),(0,s.jsxs)("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[s.jsx(l.z,{variant:"secondary",onClick:()=>y(null),children:"閉じる"}),s.jsx(l.z,{className:"bg-[#1E3A5F] hover:bg-[#16304F]",onClick:()=>N(h.id),isLoading:g===h.id,children:"承認して企業へ送る"})]})]})})]})}a(62216),a(94082)},76219:(e,t,a)=>{"use strict";a.d(t,{C:()=>n});var s=a(97247),i=a(28964),r=a(40677);let n=(0,i.forwardRef)(({className:e,variant:t="default",...a},i)=>s.jsx("span",{ref:i,className:(0,r.cn)("inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium transition-colors",{default:"bg-[#1E3A5F]/10 text-[#161B33]",success:"bg-[#48BB78]/10 text-[#48BB78]",warning:"bg-[#ED8936]/10 text-[#ED8936]",error:"bg-[#F56565]/10 text-[#F56565]",outline:"border border-gray-200 text-gray-500"}[t],e),...a}));n.displayName="Badge"},4193:(e,t,a)=>{"use strict";a.d(t,{u:()=>d});var s=a(97247);a(28964);var i=a(46817);let r=(0,a(9148).Z)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);var n=a(40677);function d({isOpen:e,onClose:t,title:a,children:d,className:l}){return e?(0,i.createPortal)(s.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 sm:p-6 bg-black/40 backdrop-blur-sm animate-in fade-in duration-200",children:(0,s.jsxs)("div",{className:(0,n.cn)("relative w-full max-w-lg transform rounded-2xl bg-white/80 backdrop-blur-2xl p-6 text-left align-middle shadow-2xl transition-all animate-in zoom-in-95 duration-200 border border-white/40",l),children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[a&&s.jsx("h3",{className:"text-lg font-medium leading-6 text-[#161B33]",children:a}),s.jsx("button",{onClick:t,className:"rounded-full p-1 hover:bg-gray-100 transition-colors",children:s.jsx(r,{className:"h-5 w-5 text-gray-500"})})]}),s.jsx("div",{children:d})]})}),document.body):null}},68170:(e,t,a)=>{"use strict";a.d(t,{v:()=>d});var s=a(94082),i=a(62216),r=a(67413);class n{async getUserEmail(e){try{let t=await (0,i.QT)((0,i.JU)(s.db,"users",e));if(t.exists())return t.data().email}catch(e){console.error("Error fetching user email:",e)}return null}async applyJob(e,t,a,n=""){try{let d=await (0,i.i3)(s.db,async r=>{let d=(0,i.hJ)(s.db,"applications"),l=(0,i.IO)(d,(0,i.ar)("studentId","==",e),(0,i.ar)("status","in",["pending_admin","pending_company","pending_student","matched"]));if(!(await (0,i.PL)(l)).empty)throw Error("Already have an active application");let c=(0,i.JU)((0,i.hJ)(s.db,"applications")),o={jobId:t,studentId:e,companyId:a,status:"pending_admin",message:n,createdAt:(0,i.Bt)(),updatedAt:(0,i.Bt)()},p=(0,i.JU)((0,i.hJ)(s.db,"notifications")),u={userId:"admin",type:"job_applied",title:"新規応募がありました",message:`求人ID: ${t} に新しい応募があります。`,link:`/admin/applications/${c.id}`,read:!1,createdAt:(0,i.Bt)()};return r.set(c,o),r.set(p,u),c.id}),l=await this.getUserEmail(e);return l&&await (0,r.C)(l,"【Internship Match】応募完了のお知らせ",`求人への応募が完了しました。

管理者の確認をお待ちください。
求人ID: ${t}`),d}catch(e){throw console.error("MatchingService.applyJob error:",e),e}}async acceptMatchByStudent(e,t){await (0,i.i3)(s.db,async a=>{let r=(0,i.JU)(s.db,"applications",e),n=await a.get(r);if(!n.exists())throw Error("Application not found");let d=n.data();if(d.studentId!==t)throw Error("Unauthorized");if("pending_student"!==d.status)throw Error("Invalid status");a.update(r,{status:"matched",updatedAt:(0,i.Bt)()});let l=(0,i.JU)((0,i.hJ)(s.db,"matches")),c={applicationId:e,jobId:d.jobId,studentId:d.studentId,companyId:d.companyId,status:"active",startDate:(0,i.Bt)(),createdAt:(0,i.Bt)()};a.set(l,c),a.update(r,{matchId:l.id});let o=(0,i.JU)((0,i.hJ)(s.db,"notifications"));a.set(o,{userId:d.companyId,type:"offer_accepted",title:"マッチング成立！",message:"学生がオファーを承諾しました。インターンシップの準備を始めましょう。",link:`/company/intern/${l.id}`,read:!1,createdAt:(0,i.Bt)()})});try{let t=await (0,i.QT)((0,i.JU)(s.db,"applications",e));if(t.exists()){let e=t.data(),a=await this.getUserEmail(e.companyId);a&&await (0,r.C)(a,"【Internship Match】マッチング成立のお知らせ",`学生がオファーを承諾しました！

マイページから詳細を確認してください。`)}}catch(e){console.error("Email send failed:",e)}}async approveByCompany(e,t){await (0,i.i3)(s.db,async a=>{let r=(0,i.JU)(s.db,"applications",e),n=await a.get(r);if(!n.exists())throw Error("Application not found");let d=n.data();if(d.companyId!==t)throw Error("Unauthorized");if("pending_company"!==d.status)throw Error("Invalid status (Must be pending_company)");a.update(r,{status:"pending_student",updatedAt:(0,i.Bt)()});let l=(0,i.JU)((0,i.hJ)(s.db,"notifications"));a.set(l,{userId:d.studentId,type:"offer_received",title:"マッチングオファーが届きました！",message:"企業があなたの応募に関心を持っています。オファーを確認してください。",link:"/student/applications",read:!1,createdAt:(0,i.Bt)()})});try{let t=await (0,i.QT)((0,i.JU)(s.db,"applications",e));if(t.exists()){let e=t.data(),a=await this.getUserEmail(e.studentId);a&&await (0,r.C)(a,"【Internship Match】オファー受信のお知らせ",`企業からオファーが届きました！

マイページから確認・承諾を行ってください。`)}}catch(e){console.error("Email send failed:",e)}}async rejectByCompany(e,t){await (0,i.i3)(s.db,async a=>{let r=(0,i.JU)(s.db,"applications",e),n=await a.get(r);if(!n.exists())throw Error("Application not found");let d=n.data();if(d.companyId!==t)throw Error("Unauthorized");a.update(r,{status:"rejected_by_company",updatedAt:(0,i.Bt)()});let l=(0,i.JU)((0,i.hJ)(s.db,"notifications"));a.set(l,{userId:d.studentId,type:"offer_rejected",title:"選考結果のお知らせ",message:"残念ながら今回の応募は見送られました。",link:"/student/applications",read:!1,createdAt:(0,i.Bt)()})});try{let t=await (0,i.QT)((0,i.JU)(s.db,"applications",e));if(t.exists()){let e=t.data(),a=await this.getUserEmail(e.studentId);a&&await (0,r.C)(a,"【Internship Match】選考結果のお知らせ",`残念ながら、今回の応募は見送られました。
またの応募をお待ちしております。`)}}catch(e){console.error("Email send failed:",e)}}async approveByAdmin(e){await (0,i.i3)(s.db,async t=>{let a=(0,i.JU)(s.db,"applications",e),r=await t.get(a);if(!r.exists())throw Error("Application not found");let n=r.data();if("pending_admin"!==n.status)throw Error("Invalid status");t.update(a,{status:"pending_company",updatedAt:(0,i.Bt)()});let d=(0,i.JU)((0,i.hJ)(s.db,"notifications"));t.set(d,{userId:n.companyId,type:"application_approved_admin",title:"新しい応募が届きました",message:"管理者承認済みの応募があります。内容を確認してください。",link:"/company/applicants",read:!1,createdAt:(0,i.Bt)()})});try{let t=await (0,i.QT)((0,i.JU)(s.db,"applications",e));if(t.exists()){let e=t.data(),a=await this.getUserEmail(e.companyId);a&&await (0,r.C)(a,"【Internship Match】新規応募のお知らせ",`新しい応募が届きました（管理者承認済み）。

マイページから応募者を確認してください。`)}}catch(e){console.error("Email send failed:",e)}}}let d=new n},665:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>s});let s=(0,a(45347).createProxy)(String.raw`/Users/kazuma/Documents/dev/intern/internship-matching/src/app/(admin)/admin/applications/page.tsx#default`)}};var t=require("../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),s=t.X(0,[379,24,564,790,906,557,783],()=>a(95223));module.exports=s})();