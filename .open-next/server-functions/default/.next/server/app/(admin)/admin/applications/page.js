(()=>{var e={};e.id=539,e.ids=[539],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},84770:e=>{"use strict";e.exports=require("crypto")},80665:e=>{"use strict";e.exports=require("dns")},17702:e=>{"use strict";e.exports=require("events")},92048:e=>{"use strict";e.exports=require("fs")},32615:e=>{"use strict";e.exports=require("http")},32694:e=>{"use strict";e.exports=require("http2")},98216:e=>{"use strict";e.exports=require("net")},19801:e=>{"use strict";e.exports=require("os")},55315:e=>{"use strict";e.exports=require("path")},35816:e=>{"use strict";e.exports=require("process")},76162:e=>{"use strict";e.exports=require("stream")},82452:e=>{"use strict";e.exports=require("tls")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},95223:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>n.a,__next_app__:()=>u,originalPathname:()=>p,pages:()=>o,routeModule:()=>m,tree:()=>c}),s(665),s(5519),s(90996),s(15539);var a=s(30170),i=s(45002),r=s(83876),n=s.n(r),d=s(66299),l={};for(let e in d)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>d[e]);s.d(t,l);let c=["",{children:["(admin)",{children:["admin",{children:["applications",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,665)),"/Users/kazuma/Documents/dev/intern/internship-matching/src/app/(admin)/admin/applications/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,5519)),"/Users/kazuma/Documents/dev/intern/internship-matching/src/app/(admin)/admin/layout.tsx"]}]},{"not-found":[()=>Promise.resolve().then(s.t.bind(s,90996,23)),"next/dist/client/components/not-found-error"],metadata:{icon:[async e=>(await Promise.resolve().then(s.bind(s,73881))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(s.bind(s,15539)),"/Users/kazuma/Documents/dev/intern/internship-matching/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,90996,23)),"next/dist/client/components/not-found-error"],metadata:{icon:[async e=>(await Promise.resolve().then(s.bind(s,73881))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}],o=["/Users/kazuma/Documents/dev/intern/internship-matching/src/app/(admin)/admin/applications/page.tsx"],p="/(admin)/admin/applications/page",u={require:s,loadChunk:()=>Promise.resolve()},m=new a.AppPageRouteModule({definition:{kind:i.x.APP_PAGE,page:"/(admin)/admin/applications/page",pathname:"/admin/applications",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},58992:(e,t,s)=>{Promise.resolve().then(s.bind(s,38304))},50820:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});let a=(0,s(9148).Z)("calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]])},38304:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>x});var a=s(97247),i=s(28964),r=s(57793),n=s(68170),d=s(17596),l=s(55039),c=s(76219),o=s(8749),p=s(50820),u=s(8553),m=s(4193);function x(){let[e,t]=(0,i.useState)([]),[s,x]=(0,i.useState)(!0),[h,g]=(0,i.useState)(null),[y,b]=(0,i.useState)(null),f=async e=>{try{let t=await r.d.getApplicationDetails(e);g({...e,...t})}catch(e){console.error(e),alert("詳細の取得に失敗しました")}},v=async e=>{if(confirm("この応募を承認して、企業側へ通知しますか？")){b(e);try{await n.v.approveByAdmin(e),t(t=>t.filter(t=>t.id!==e)),g(null)}catch(e){console.error(e),alert("承認に失敗しました")}finally{b(null)}}};return s?a.jsx("div",{className:"flex justify-center p-12",children:a.jsx(o.Z,{className:"animate-spin"})}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[a.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"応募承認"}),(0,a.jsxs)("p",{className:"text-gray-500",children:["管理者確認待ちの応募が ",e.length," 件あります"]})]}),0===e.length?a.jsx(d.Z,{className:"p-12 text-center text-gray-500",children:"確認待ちの応募はありません。"}):a.jsx("div",{className:"grid gap-4",children:e.map(e=>a.jsx(d.Z,{className:"p-6",children:(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[a.jsx(c.C,{variant:"warning",children:"管理者承認待ち"}),(0,a.jsxs)("span",{className:"text-xs text-gray-500",children:["ID: ",e.id]})]}),a.jsx("div",{className:"flex items-center gap-4 text-sm text-gray-600 mb-2",children:(0,a.jsxs)("span",{className:"flex items-center gap-1",children:[a.jsx(p.Z,{size:14})," Applied: ",(0,u.WU)(e.createdAt.toDate(),"yyyy/MM/dd HH:mm")]})}),(0,a.jsxs)("p",{className:"text-sm font-bold",children:["Message: ",e.message.substring(0,50),"..."]})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[a.jsx(l.z,{variant:"outline",onClick:()=>f(e),children:"詳細"}),a.jsx(l.z,{className:"bg-green-600 hover:bg-green-700",isLoading:y===e.id,onClick:()=>v(e.id),children:"承認"})]})]})},e.id))}),a.jsx(m.u,{isOpen:!!h,onClose:()=>g(null),title:"応募詳細",children:h&&(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[a.jsx("h2",{className:"font-bold text-lg mb-4",children:"応募情報"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,a.jsxs)("div",{children:[a.jsx("label",{className:"text-xs text-gray-400 block",children:"学生"}),a.jsx("p",{className:"font-bold",children:h.student?.name||h.studentId}),a.jsx("p",{className:"text-xs",children:h.student?.university})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"text-xs text-gray-400 block",children:"企業 / 求人"}),a.jsx("p",{className:"font-bold",children:h.company?.name||h.companyId}),a.jsx("p",{className:"text-xs",children:h.job?.title||h.jobId})]})]})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"text-xs text-gray-400 block mb-1",children:"メッセージ"}),a.jsx("div",{className:"bg-gray-50 p-3 rounded text-sm whitespace-pre-wrap",children:h.message})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[a.jsx(l.z,{variant:"secondary",onClick:()=>g(null),children:"閉じる"}),a.jsx(l.z,{className:"bg-green-600 hover:bg-green-700",onClick:()=>v(h.id),isLoading:y===h.id,children:"承認して企業へ送る"})]})]})})]})}},76219:(e,t,s)=>{"use strict";s.d(t,{C:()=>n});var a=s(97247),i=s(28964),r=s(40677);let n=(0,i.forwardRef)(({className:e,variant:t="default",...s},i)=>a.jsx("span",{ref:i,className:(0,r.cn)("inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium transition-colors",{default:"bg-[#1E3A5F]/10 text-[#161B33]",success:"bg-[#48BB78]/10 text-[#48BB78]",warning:"bg-[#ED8936]/10 text-[#ED8936]",error:"bg-[#F56565]/10 text-[#F56565]",outline:"border border-gray-200 text-gray-500"}[t],e),...s}));n.displayName="Badge"},4193:(e,t,s)=>{"use strict";s.d(t,{u:()=>d});var a=s(97247);s(28964);var i=s(46817);let r=(0,s(9148).Z)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);var n=s(40677);function d({isOpen:e,onClose:t,title:s,children:d,className:l}){return e?(0,i.createPortal)(a.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 sm:p-6 bg-black/40 backdrop-blur-sm animate-in fade-in duration-200",children:(0,a.jsxs)("div",{className:(0,n.cn)("relative w-full max-w-lg transform rounded-2xl bg-white/80 backdrop-blur-2xl p-6 text-left align-middle shadow-2xl transition-all animate-in zoom-in-95 duration-200 border border-white/40",l),children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[s&&a.jsx("h3",{className:"text-lg font-medium leading-6 text-[#161B33]",children:s}),a.jsx("button",{onClick:t,className:"rounded-full p-1 hover:bg-gray-100 transition-colors",children:a.jsx(r,{className:"h-5 w-5 text-gray-500"})})]}),a.jsx("div",{children:d})]})}),document.body):null}},68170:(e,t,s)=>{"use strict";s.d(t,{v:()=>n});var a=s(94082),i=s(62216);class r{async applyJob(e,t,s,r=""){try{return await (0,i.i3)(a.db,async n=>{let d=(0,i.hJ)(a.db,"applications"),l=(0,i.IO)(d,(0,i.ar)("studentId","==",e),(0,i.ar)("status","in",["pending_admin","pending_company","pending_student","matched"]));if(!(await (0,i.PL)(l)).empty)throw Error("Already have an active application");let c=(0,i.JU)((0,i.hJ)(a.db,"applications")),o={jobId:t,studentId:e,companyId:s,status:"pending_admin",message:r,createdAt:(0,i.Bt)(),updatedAt:(0,i.Bt)()},p=(0,i.JU)((0,i.hJ)(a.db,"notifications")),u={userId:"admin",type:"job_applied",title:"新規応募がありました",message:`求人ID: ${t} に新しい応募があります。`,link:`/admin/applications/${c.id}`,read:!1,createdAt:(0,i.Bt)()};return n.set(c,o),n.set(p,u),c.id})}catch(e){throw console.error("MatchingService.applyJob error:",e),e}}async acceptMatchByStudent(e,t){await (0,i.i3)(a.db,async s=>{let r=(0,i.JU)(a.db,"applications",e),n=await s.get(r);if(!n.exists())throw Error("Application not found");let d=n.data();if(d.studentId!==t)throw Error("Unauthorized");if("pending_student"!==d.status)throw Error("Invalid status");s.update(r,{status:"matched",updatedAt:(0,i.Bt)()});let l=(0,i.JU)((0,i.hJ)(a.db,"matches")),c={applicationId:e,jobId:d.jobId,studentId:d.studentId,companyId:d.companyId,status:"active",startDate:(0,i.Bt)(),createdAt:(0,i.Bt)()};s.set(l,c),s.update(r,{matchId:l.id});let o=(0,i.JU)((0,i.hJ)(a.db,"notifications"));s.set(o,{userId:d.companyId,type:"offer_accepted",title:"マッチング成立！",message:"学生がオファーを承諾しました。インターンシップの準備を始めましょう。",link:`/company/intern/${l.id}`,read:!1,createdAt:(0,i.Bt)()})})}async approveByCompany(e,t){await (0,i.i3)(a.db,async s=>{let r=(0,i.JU)(a.db,"applications",e),n=await s.get(r);if(!n.exists())throw Error("Application not found");let d=n.data();if(d.companyId!==t)throw Error("Unauthorized");if("pending_company"!==d.status)throw Error("Invalid status (Must be pending_company)");s.update(r,{status:"pending_student",updatedAt:(0,i.Bt)()});let l=(0,i.JU)((0,i.hJ)(a.db,"notifications"));s.set(l,{userId:d.studentId,type:"offer_received",title:"マッチングオファーが届きました！",message:"企業があなたの応募に関心を持っています。オファーを確認してください。",link:"/student/applications",read:!1,createdAt:(0,i.Bt)()})})}async rejectByCompany(e,t){await (0,i.i3)(a.db,async s=>{let r=(0,i.JU)(a.db,"applications",e),n=await s.get(r);if(!n.exists())throw Error("Application not found");let d=n.data();if(d.companyId!==t)throw Error("Unauthorized");s.update(r,{status:"rejected_by_company",updatedAt:(0,i.Bt)()});let l=(0,i.JU)((0,i.hJ)(a.db,"notifications"));s.set(l,{userId:d.studentId,type:"offer_rejected",title:"選考結果のお知らせ",message:"残念ながら今回の応募は見送られました。",link:"/student/applications",read:!1,createdAt:(0,i.Bt)()})})}async approveByAdmin(e){await (0,i.i3)(a.db,async t=>{let s=(0,i.JU)(a.db,"applications",e),r=await t.get(s);if(!r.exists())throw Error("Application not found");let n=r.data();if("pending_admin"!==n.status)throw Error("Invalid status");t.update(s,{status:"pending_company",updatedAt:(0,i.Bt)()});let d=(0,i.JU)((0,i.hJ)(a.db,"notifications"));t.set(d,{userId:n.companyId,type:"application_approved_admin",title:"新しい応募が届きました",message:"管理者承認済みの応募があります。内容を確認してください。",link:"/company/applicants",read:!1,createdAt:(0,i.Bt)()})})}}let n=new r},665:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>a});let a=(0,s(45347).createProxy)(String.raw`/Users/kazuma/Documents/dev/intern/internship-matching/src/app/(admin)/admin/applications/page.tsx#default`)}};var t=require("../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),a=t.X(0,[379,499,331,906,106,553,783],()=>s(95223));module.exports=a})();