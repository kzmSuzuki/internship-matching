(()=>{var e={};e.id=639,e.ids=[639],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},84770:e=>{"use strict";e.exports=require("crypto")},80665:e=>{"use strict";e.exports=require("dns")},17702:e=>{"use strict";e.exports=require("events")},92048:e=>{"use strict";e.exports=require("fs")},32615:e=>{"use strict";e.exports=require("http")},32694:e=>{"use strict";e.exports=require("http2")},98216:e=>{"use strict";e.exports=require("net")},19801:e=>{"use strict";e.exports=require("os")},55315:e=>{"use strict";e.exports=require("path")},35816:e=>{"use strict";e.exports=require("process")},76162:e=>{"use strict";e.exports=require("stream")},82452:e=>{"use strict";e.exports=require("tls")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},55020:(e,t,a)=>{"use strict";a.r(t),a.d(t,{GlobalError:()=>n.a,__next_app__:()=>u,originalPathname:()=>p,pages:()=>o,routeModule:()=>m,tree:()=>c}),a(73400),a(1360),a(90996),a(15539);var s=a(30170),i=a(45002),r=a(83876),n=a.n(r),d=a(66299),l={};for(let e in d)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>d[e]);a.d(t,l);let c=["",{children:["(company)",{children:["company",{children:["applicants",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(a.bind(a,73400)),"/Users/kazuma/Documents/dev/intern/internship-matching/src/app/(company)/company/applicants/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(a.bind(a,1360)),"/Users/kazuma/Documents/dev/intern/internship-matching/src/app/(company)/company/layout.tsx"]}]},{"not-found":[()=>Promise.resolve().then(a.t.bind(a,90996,23)),"next/dist/client/components/not-found-error"],metadata:{icon:[async e=>(await Promise.resolve().then(a.bind(a,73881))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(a.bind(a,15539)),"/Users/kazuma/Documents/dev/intern/internship-matching/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(a.t.bind(a,90996,23)),"next/dist/client/components/not-found-error"],metadata:{icon:[async e=>(await Promise.resolve().then(a.bind(a,73881))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}],o=["/Users/kazuma/Documents/dev/intern/internship-matching/src/app/(company)/company/applicants/page.tsx"],p="/(company)/company/applicants/page",u={require:a,loadChunk:()=>Promise.resolve()},m=new s.AppPageRouteModule({definition:{kind:i.x.APP_PAGE,page:"/(company)/company/applicants/page",pathname:"/company/applicants",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},54026:(e,t,a)=>{Promise.resolve().then(a.bind(a,10487))},10487:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>g});var s=a(97247),i=a(28964);a(62216),a(94082);var r=a(222),n=a(17596),d=a(55039),l=a(76219),c=a(4193),o=a(8749),p=a(42310),u=a(96369),m=a(34178),x=a(68170);let h=()=>process.env.NEXT_PUBLIC_APP_URL||"",f={async send(e,t,a){try{let s=await fetch("/api/email/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({to:e,subject:t,body:a})}),i=await s.json();if(!s.ok)throw Error(i.error||"Failed to send email")}catch(e){console.error("Failed to send email:",e)}},async notifyOffer(e,t,a,s,i){let r=`【重要】${a}からマッチングオファーが届きました`,n=`${t} 様

お世話になっております、${a}です。

以下の求人につきまして、ぜひ一度お話しさせていただきたく、マッチングオファーをお送りいたします。

求人名: ${s}

【企業からのメッセージ】
${i}

以下のリンクから詳細をご確認の上、承諾をお願いいたします。
${h()}/student/applications

-------------------
Internship Matching App`;await this.send(e,r,n)},async notifyRejection(e,t,a,s){let i=`【選考結果】${a}への応募について`,r=`${t} 様

この度は、${a}の「${s}」へご応募いただき誠にありがとうございます。

慎重に選考を行いました結果、誠に残念ながら今回はご期待に沿えない結果となりました。

${t} 様の今後のご活躍をお祈り申し上げます。

-------------------
Internship Matching App`;await this.send(e,i,r)}};var y=a(95525);function g(){let{user:e}=(0,r.a)(),t=(0,m.useRouter)(),[a,h]=(0,i.useState)([]),[g,b]=(0,i.useState)(!0),[j,v]=(0,i.useState)(null),[w,N]=(0,i.useState)(null),[I,_]=(0,i.useState)(null),[B,E]=(0,i.useState)(""),A=(e,t)=>{_({appId:e.id,action:t}),"offer"===t?E("ぜひ、よろしくお願いします。\n"):E("誠に残念ながら、今回はご縁がありませんでした。\n今後のご活躍をお祈り申し上げます。")},k=async()=>{if(!I||!e)return;let{appId:t,action:s}=I,i=a.find(e=>e.id===t);if(i){v(t);try{"offer"===s?(await x.v.approveByCompany(t,e.id),await y.B.createNotification(i.studentId,"マッチングオファー",`${e.name||"企業"}からオファーが届きました！`,"offer_received","/student/applications"),i.student.email&&await f.notifyOffer(i.student.email,i.student.name,e.name||"企業",i.job.title,B)):"reject"===s&&(await x.v.rejectByCompany(t,e.id),await y.B.createNotification(i.studentId,"選考結果のお知らせ",`残念ながら${e.name||"企業"}とのマッチングは成立しませんでした。`,"offer_rejected","/student/applications"),i.student.email&&await f.notifyRejection(i.student.email,i.student.name,e.name||"企業",i.job.title));let a="offer"===s?"pending_student":"rejected_by_company";h(e=>e.map(e=>e.id===t?{...e,status:a}:e)),_(null),N(null)}catch(e){console.error("Error updating status:",e),alert("ステータス更新に失敗しました: "+e.message)}finally{v(null)}}};return g?s.jsx("div",{className:"flex justify-center p-12",children:s.jsx(o.Z,{className:"animate-spin text-[#1E3A5F]"})}):(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{children:[s.jsx("h1",{className:"text-2xl font-bold text-[#1E3A5F]",children:"応募者管理"}),s.jsx("p",{className:"text-gray-500",children:"求人への応募者を確認し、選考を進めましょう"})]}),0===a.length?s.jsx(n.Z,{className:"p-12 text-center text-gray-500",children:s.jsx("p",{children:"現在、応募者はいません。"})}):s.jsx("div",{className:"grid gap-4",children:a.map(e=>s.jsx(n.Z,{className:"p-6",children:(0,s.jsxs)("div",{className:"flex flex-col md:flex-row justify-between gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx("h3",{className:"text-lg font-bold text-[#1E3A5F]",children:e.student.name}),s.jsx(l.C,{variant:"outline",className:"text-xs",children:e.student.university||"大学未設定"}),s.jsx("span",{className:"text-xs text-gray-400",children:e.student.grade})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-600 mb-2",children:[s.jsx(p.Z,{size:14}),(0,s.jsxs)("span",{children:["応募先: ",e.job.title]})]}),(0,s.jsxs)("div",{className:"flex gap-2 mb-2",children:["pending_admin"===e.status&&s.jsx(l.C,{variant:"warning",children:"管理者承認待ち"}),"pending_company"===e.status&&s.jsx(l.C,{variant:"warning",className:"animate-pulse",children:"対応待ち"}),"pending_student"===e.status&&s.jsx(l.C,{variant:"success",children:"オファー済み"}),"matched"===e.status&&s.jsx(l.C,{variant:"success",className:"bg-green-600 text-white",children:"マッチング成立"}),e.status.includes("rejected")&&s.jsx(l.C,{variant:"error",className:"bg-gray-100 text-gray-500",children:"不採用"})]}),(0,s.jsxs)("p",{className:"text-xs text-gray-400",children:["応募日: ",(0,u.WU)(e.createdAt.toDate(),"yyyy/MM/dd HH:mm")]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[s.jsx(d.z,{variant:"outline",onClick:()=>N(e),children:"詳細・プロフィール"}),"pending_company"===e.status&&(0,s.jsxs)(s.Fragment,{children:[s.jsx(d.z,{onClick:()=>A(e,"offer"),isLoading:j===e.id,className:"bg-[#48BB78] hover:bg-[#48BB78]/90",children:"オファー承認"}),s.jsx(d.z,{variant:"danger",className:"bg-red-50 text-red-600 hover:bg-red-100 border-red-200",onClick:()=>A(e,"reject"),disabled:!!j,children:"不採用"})]}),("matched"===e.status||"completed"===e.status)&&e.matchId&&s.jsx("div",{className:"ml-2",children:s.jsx(d.z,{variant:"outline",className:"bg-[#1E3A5F]/5 border-[#1E3A5F]/20 text-[#1E3A5F]",onClick:()=>t.push(`/company/intern/${e.matchId}`),children:"インターン管理画面へ"})})]})]})},e.id))}),s.jsx(c.u,{isOpen:!!w,onClose:()=>N(null),title:"応募者詳細",children:w&&(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[s.jsx("label",{className:"text-xs text-gray-500",children:"氏名"}),s.jsx("p",{className:"font-medium text-lg",children:w.student.name})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{className:"text-xs text-gray-500",children:"所属"}),(0,s.jsxs)("p",{children:[w.student.university," ",w.student.grade]})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{className:"text-xs text-gray-500",children:"自己PR / BIO"}),s.jsx("div",{className:"bg-gray-50 p-3 rounded-lg text-sm whitespace-pre-wrap",children:w.student.bio||"未入力"})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{className:"text-xs text-gray-500",children:"スキル"}),s.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:w.student.skills?.map((e,t)=>s.jsx(l.C,{variant:"outline",className:"text-xs",children:e},t))})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{className:"text-xs text-gray-500",children:"ポートフォリオ / リンク"}),s.jsx("ul",{className:"list-disc list-inside text-sm text-blue-600",children:w.student.links?.map((e,t)=>s.jsx("li",{children:s.jsx("a",{href:e,target:"_blank",rel:"noopener noreferrer",className:"hover:underline",children:e})},t))})]}),(0,s.jsxs)("div",{className:"border-t pt-4 mt-4",children:[s.jsx("label",{className:"text-xs text-gray-500",children:"応募メッセージ"}),s.jsx("p",{className:"text-sm mt-1",children:w.message})]}),"pending_company"===w.status&&(0,s.jsxs)("div",{className:"flex gap-2 justify-end mt-6 pt-4 border-t",children:[s.jsx(d.z,{variant:"danger",className:"bg-red-50 text-red-600 hover:bg-red-100 border-red-200",onClick:()=>{N(null),A(w,"reject")},children:"不採用"}),s.jsx(d.z,{onClick:()=>{N(null),A(w,"offer")},className:"bg-[#48BB78] hover:bg-[#48BB78]/90",children:"オファー承認"})]}),s.jsx("div",{className:"flex justify-end pt-2",children:s.jsx(d.z,{variant:"secondary",onClick:()=>N(null),children:"閉じる"})})]})}),s.jsx(c.u,{isOpen:!!I,onClose:()=>_(null),title:I?.action==="offer"?"オファー承認・メッセージ送信":"不採用通知",children:(0,s.jsxs)("div",{className:"space-y-4",children:[s.jsx("p",{className:"text-sm text-gray-600",children:I?.action==="offer"?"学生にマッチングオファーを送ります。以下のメッセージがメールで送信されます。":"この学生を不採用にします。この操作は取り消せません。"}),(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"メッセージ"}),s.jsx("textarea",{className:"w-full h-32 rounded-lg border border-gray-200 bg-white px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-[#1E3A5F]",value:B,onChange:e=>E(e.target.value),placeholder:"メッセージを入力してください..."}),s.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"※ このメッセージはメール通知に含まれます。"})]}),(0,s.jsxs)("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[s.jsx(d.z,{variant:"secondary",onClick:()=>_(null),children:"キャンセル"}),s.jsx(d.z,{onClick:k,isLoading:!!j,className:I?.action==="offer"?"bg-[#48BB78]":"bg-red-600 hover:bg-red-700 text-white",children:I?.action==="offer"?"オファーを送る":"不採用にする"})]})]})})]})}},76219:(e,t,a)=>{"use strict";a.d(t,{C:()=>n});var s=a(97247),i=a(28964),r=a(40677);let n=(0,i.forwardRef)(({className:e,variant:t="default",...a},i)=>s.jsx("span",{ref:i,className:(0,r.cn)("inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium transition-colors",{default:"bg-[#1E3A5F]/10 text-[#161B33]",success:"bg-[#48BB78]/10 text-[#48BB78]",warning:"bg-[#ED8936]/10 text-[#ED8936]",error:"bg-[#F56565]/10 text-[#F56565]",outline:"border border-gray-200 text-gray-500"}[t],e),...a}));n.displayName="Badge"},4193:(e,t,a)=>{"use strict";a.d(t,{u:()=>d});var s=a(97247);a(28964);var i=a(46817);let r=(0,a(9148).Z)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);var n=a(40677);function d({isOpen:e,onClose:t,title:a,children:d,className:l}){return e?(0,i.createPortal)(s.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 sm:p-6 bg-black/40 backdrop-blur-sm animate-in fade-in duration-200",children:(0,s.jsxs)("div",{className:(0,n.cn)("relative w-full max-w-lg transform rounded-2xl bg-white/80 backdrop-blur-2xl p-6 text-left align-middle shadow-2xl transition-all animate-in zoom-in-95 duration-200 border border-white/40",l),children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[a&&s.jsx("h3",{className:"text-lg font-medium leading-6 text-[#161B33]",children:a}),s.jsx("button",{onClick:t,className:"rounded-full p-1 hover:bg-gray-100 transition-colors",children:s.jsx(r,{className:"h-5 w-5 text-gray-500"})})]}),s.jsx("div",{children:d})]})}),document.body):null}},67413:(e,t,a)=>{"use strict";async function s(e,t,a){try{let s=await fetch("/api/send-email",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({to:e,subject:t,body:a})});if(!s.ok)return console.error("Failed to send email:",await s.text()),!1;return!0}catch(e){return console.error("Error sending email:",e),!1}}a.d(t,{C:()=>s})},68170:(e,t,a)=>{"use strict";a.d(t,{v:()=>d});var s=a(94082),i=a(62216),r=a(67413);class n{async getUserEmail(e){try{let t=await (0,i.QT)((0,i.JU)(s.db,"users",e));if(t.exists())return t.data().email}catch(e){console.error("Error fetching user email:",e)}return null}async applyJob(e,t,a,n=""){try{let d=await (0,i.i3)(s.db,async r=>{let d=(0,i.hJ)(s.db,"applications"),l=(0,i.IO)(d,(0,i.ar)("studentId","==",e),(0,i.ar)("status","in",["pending_admin","pending_company","pending_student","matched"]));if(!(await (0,i.PL)(l)).empty)throw Error("Already have an active application");let c=(0,i.JU)((0,i.hJ)(s.db,"applications")),o={jobId:t,studentId:e,companyId:a,status:"pending_admin",message:n,createdAt:(0,i.Bt)(),updatedAt:(0,i.Bt)()},p=(0,i.JU)((0,i.hJ)(s.db,"notifications")),u={userId:"admin",type:"job_applied",title:"新規応募がありました",message:`求人ID: ${t} に新しい応募があります。`,link:`/admin/applications/${c.id}`,read:!1,createdAt:(0,i.Bt)()};return r.set(c,o),r.set(p,u),c.id}),l=await this.getUserEmail(e);return l&&await (0,r.C)(l,"【Internship Match】応募完了のお知らせ",`求人への応募が完了しました。

管理者の確認をお待ちください。
求人ID: ${t}`),d}catch(e){throw console.error("MatchingService.applyJob error:",e),e}}async acceptMatchByStudent(e,t){await (0,i.i3)(s.db,async a=>{let r=(0,i.JU)(s.db,"applications",e),n=await a.get(r);if(!n.exists())throw Error("Application not found");let d=n.data();if(d.studentId!==t)throw Error("Unauthorized");if("pending_student"!==d.status)throw Error("Invalid status");a.update(r,{status:"matched",updatedAt:(0,i.Bt)()});let l=(0,i.JU)((0,i.hJ)(s.db,"matches")),c={applicationId:e,jobId:d.jobId,studentId:d.studentId,companyId:d.companyId,status:"active",startDate:(0,i.Bt)(),createdAt:(0,i.Bt)()};a.set(l,c),a.update(r,{matchId:l.id});let o=(0,i.JU)((0,i.hJ)(s.db,"notifications"));a.set(o,{userId:d.companyId,type:"offer_accepted",title:"マッチング成立！",message:"学生がオファーを承諾しました。インターンシップの準備を始めましょう。",link:`/company/intern/${l.id}`,read:!1,createdAt:(0,i.Bt)()})});try{let t=await (0,i.QT)((0,i.JU)(s.db,"applications",e));if(t.exists()){let e=t.data(),a=await this.getUserEmail(e.companyId);a&&await (0,r.C)(a,"【Internship Match】マッチング成立のお知らせ",`学生がオファーを承諾しました！

マイページから詳細を確認してください。`)}}catch(e){console.error("Email send failed:",e)}}async approveByCompany(e,t){await (0,i.i3)(s.db,async a=>{let r=(0,i.JU)(s.db,"applications",e),n=await a.get(r);if(!n.exists())throw Error("Application not found");let d=n.data();if(d.companyId!==t)throw Error("Unauthorized");if("pending_company"!==d.status)throw Error("Invalid status (Must be pending_company)");a.update(r,{status:"pending_student",updatedAt:(0,i.Bt)()});let l=(0,i.JU)((0,i.hJ)(s.db,"notifications"));a.set(l,{userId:d.studentId,type:"offer_received",title:"マッチングオファーが届きました！",message:"企業があなたの応募に関心を持っています。オファーを確認してください。",link:"/student/applications",read:!1,createdAt:(0,i.Bt)()})});try{let t=await (0,i.QT)((0,i.JU)(s.db,"applications",e));if(t.exists()){let e=t.data(),a=await this.getUserEmail(e.studentId);a&&await (0,r.C)(a,"【Internship Match】オファー受信のお知らせ",`企業からオファーが届きました！

マイページから確認・承諾を行ってください。`)}}catch(e){console.error("Email send failed:",e)}}async rejectByCompany(e,t){await (0,i.i3)(s.db,async a=>{let r=(0,i.JU)(s.db,"applications",e),n=await a.get(r);if(!n.exists())throw Error("Application not found");let d=n.data();if(d.companyId!==t)throw Error("Unauthorized");a.update(r,{status:"rejected_by_company",updatedAt:(0,i.Bt)()});let l=(0,i.JU)((0,i.hJ)(s.db,"notifications"));a.set(l,{userId:d.studentId,type:"offer_rejected",title:"選考結果のお知らせ",message:"残念ながら今回の応募は見送られました。",link:"/student/applications",read:!1,createdAt:(0,i.Bt)()})});try{let t=await (0,i.QT)((0,i.JU)(s.db,"applications",e));if(t.exists()){let e=t.data(),a=await this.getUserEmail(e.studentId);a&&await (0,r.C)(a,"【Internship Match】選考結果のお知らせ",`残念ながら、今回の応募は見送られました。
またの応募をお待ちしております。`)}}catch(e){console.error("Email send failed:",e)}}async approveByAdmin(e){await (0,i.i3)(s.db,async t=>{let a=(0,i.JU)(s.db,"applications",e),r=await t.get(a);if(!r.exists())throw Error("Application not found");let n=r.data();if("pending_admin"!==n.status)throw Error("Invalid status");t.update(a,{status:"pending_company",updatedAt:(0,i.Bt)()});let d=(0,i.JU)((0,i.hJ)(s.db,"notifications"));t.set(d,{userId:n.companyId,type:"application_approved_admin",title:"新しい応募が届きました",message:"管理者承認済みの応募があります。内容を確認してください。",link:"/company/applicants",read:!1,createdAt:(0,i.Bt)()})});try{let t=await (0,i.QT)((0,i.JU)(s.db,"applications",e));if(t.exists()){let e=t.data(),a=await this.getUserEmail(e.companyId);a&&await (0,r.C)(a,"【Internship Match】新規応募のお知らせ",`新しい応募が届きました（管理者承認済み）。

マイページから応募者を確認してください。`)}}catch(e){console.error("Email send failed:",e)}}}let d=new n},95525:(e,t,a)=>{"use strict";a.d(t,{B:()=>n});var s=a(94082),i=a(62216);a(28964);class r{async markAsRead(e){let t=(0,i.JU)(s.db,"notifications",e);await (0,i.r7)(t,{read:!0,updatedAt:(0,i.Bt)()})}async markAllAsRead(e){let t=(0,i.IO)((0,i.hJ)(s.db,"notifications"),(0,i.ar)("userId","==",e),(0,i.ar)("read","==",!1)),a=await (0,i.PL)(t);if(a.empty)return;let r=(0,i.qs)(s.db);a.docs.forEach(e=>{r.update(e.ref,{read:!0,updatedAt:(0,i.Bt)()})}),await r.commit()}async createNotification(e,t,a,r,n){try{await (0,i.ET)((0,i.hJ)(s.db,"notifications"),{userId:e,title:t,message:a,type:r,link:n,read:!1,createdAt:(0,i.Bt)()})}catch(e){console.error("Error creating notification:",e)}}}let n=new r},73400:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>s});let s=(0,a(45347).createProxy)(String.raw`/Users/kazuma/Documents/dev/intern/internship-matching/src/app/(company)/company/applicants/page.tsx#default`)}};var t=require("../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),s=t.X(0,[379,24,564,790,906,557,511],()=>a(55020));module.exports=s})();